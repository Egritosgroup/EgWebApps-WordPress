"use strict";(self.webpackChunkegritos_group_eg_web_apps=self.webpackChunkegritos_group_eg_web_apps||[]).push([[712],{37712:function(e,t,s){s.r(t),s.d(t,{EpaymentsModule:function(){return me}});var i=s(43645),n=s(29790),a=s(88052),r=s(54655),o=s(68214),l=s(79765),p=s(46782),d=s(37716),c=s(87622),h=s(12622),u=s(38583),g=s(3379),m=s(24020),f=s(44748),b=s(43190),y=s(84608),Z=s(23292),_=s(35746),A=s(84439),x=s(33013),w=s(3679),T=s(86640),C=s(12332);function k(e,t){if(1&e&&d._UZ(0,"p-message",4),2&e){const e=d.oxw();d.Q6J("text",e.bankStatusMessage)("styleClass","mt-2")}}function q(e,t){if(1&e&&d._UZ(0,"p-message",4),2&e){const e=d.oxw(2);d.Q6J("text",e.translation.epayments.noCheckedDebits)("styleClass","my-2")}}function D(e,t){1&e&&d._UZ(0,"p-message",6),2&e&&d.Q6J("styleClass","my-2")}function S(e,t){1&e&&d.GkF(0)}function v(e,t){if(1&e&&(d.TgZ(0,"div",15),d.YNc(1,S,1,0,"ng-container",16),d.qZA()),2&e){d.oxw(3);const e=d.MAs(4);d.xp6(1),d.Q6J("ngTemplateOutlet",e)}}function O(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"form",17),d.TgZ(1,"label"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"ng-select",18),d.NdJ("ngModelChange",function(t){return d.CHM(e),d.oxw(3).selectedEidosId=t})("ngModelChange",function(t){return d.CHM(e),d.oxw(3).onSelectedPersistedTypeChanged(t)}),d.qZA(),d.qZA()}if(2&e){const e=d.oxw(3);d.xp6(2),d.Oqu(d.lcZ(3,4,e.translation.epayments.debitType)),d.xp6(2),d.Q6J("items",e.eidosDebit)("ngModel",e.selectedEidosId)("clearable",!1)}}function L(e,t){if(1&e&&(d.TgZ(0,"div",19),d.TgZ(1,"span",20),d._UZ(2,"i",21),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"span",20),d._UZ(6,"i",22),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.qZA()),2&e){const e=d.oxw(3);d.xp6(3),d.hij(" ",d.lcZ(4,2,e.translation.epayments.persistedDebit),""),d.xp6(4),d.hij(" ",d.lcZ(8,4,e.translation.epayments.nonPersistedDebit),"")}}function R(e,t){if(1&e&&(d.TgZ(0,"th",26),d._uU(1),d.ALo(2,"translate"),d.qZA()),2&e){const e=d.oxw(4);d.xp6(1),d.Oqu(d.lcZ(2,1,e.translation.egwebapps.debitType))}}function U(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"tr"),d.TgZ(1,"th",23),d.TgZ(2,"p-checkbox",24),d.NdJ("ngModelChange",function(t){return d.CHM(e),d.oxw(3).isAllDebitsChecked=t})("onChange",function(){return d.CHM(e),d.oxw(3).onAllDebitsSelected()}),d.qZA(),d.qZA(),d.YNc(3,R,3,3,"th",25),d.TgZ(4,"th",26),d._uU(5),d.ALo(6,"translate"),d.qZA(),d.TgZ(7,"th",27),d._uU(8),d.ALo(9,"translate"),d.qZA(),d.TgZ(10,"th",28),d._uU(11),d.ALo(12,"translate"),d.qZA(),d.TgZ(13,"th",29),d._uU(14),d.ALo(15,"translate"),d._UZ(16,"p-sortIcon",30),d.qZA(),d.TgZ(17,"th",31),d._uU(18),d.ALo(19,"translate"),d._UZ(20,"p-sortIcon",32),d.qZA(),d.TgZ(21,"th",33),d._uU(22),d.ALo(23,"translate"),d._UZ(24,"p-sortIcon",34),d.qZA(),d.TgZ(25,"th",35),d._uU(26),d.ALo(27,"translate"),d._UZ(28,"p-sortIcon",36),d.qZA(),d.qZA()}if(2&e){const e=d.oxw(3);d.xp6(2),d.Q6J("binary",!0)("ngModel",e.isAllDebitsChecked),d.xp6(1),d.Q6J("ngIf",e.isNonPersistedEnabled),d.xp6(2),d.Oqu(d.lcZ(6,10,e.translation.egwebapps.egrAA)),d.xp6(3),d.Oqu(d.lcZ(9,12,e.translation.egwebapps.egrXK)),d.xp6(3),d.Oqu(d.lcZ(12,14,e.translation.egwebapps.description)),d.xp6(3),d.hij("",d.lcZ(15,16,e.translation.egwebapps.egrExpDate)," "),d.xp6(4),d.hij("",d.lcZ(19,18,e.translation.epayments.netPoso)," "),d.xp6(4),d.hij("",d.lcZ(23,20,e.translation.egwebapps.egrOngoingCharges),"* "),d.xp6(4),d.hij("",d.lcZ(27,22,e.translation.egwebapps.egrTotalCost)," ")}}function M(e,t){if(1&e&&(d.TgZ(0,"td",23),d.TgZ(1,"span",37),d._uU(2),d.ALo(3,"translate"),d.qZA(),d._UZ(4,"i",41),d.qZA()),2&e){const e=d.oxw().$implicit,t=d.oxw(3);d.xp6(2),d.Oqu(d.lcZ(3,2,t.translation.egwebapps.debitType)),d.xp6(2),d.Q6J("ngClass",e.isBebaiomeno?"far fa-dot-circle text-success":"fas fa-dot-circle text-warning")}}function P(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"tr"),d.TgZ(1,"td",23),d.TgZ(2,"span",37),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"p-checkbox",24),d.NdJ("ngModelChange",function(t){return d.CHM(e).$implicit.isChecked=t})("onChange",function(){return d.CHM(e),d.oxw(3)._calculateTotalAmounts()}),d.qZA(),d.qZA(),d.YNc(6,M,5,4,"td",38),d.TgZ(7,"td",26),d.TgZ(8,"span",37),d._uU(9),d.ALo(10,"translate"),d.qZA(),d._uU(11),d.qZA(),d.TgZ(12,"td",27),d.TgZ(13,"span",37),d._uU(14),d.ALo(15,"translate"),d.qZA(),d._uU(16),d.qZA(),d.TgZ(17,"td",28),d.TgZ(18,"span",37),d._uU(19),d.ALo(20,"translate"),d.qZA(),d._uU(21),d.qZA(),d.TgZ(22,"td",39),d.TgZ(23,"span",37),d._uU(24),d.ALo(25,"translate"),d.qZA(),d._uU(26),d.ALo(27,"date"),d.qZA(),d.TgZ(28,"td",40),d.TgZ(29,"span",37),d._uU(30),d.ALo(31,"translate"),d.qZA(),d._uU(32),d.ALo(33,"currency"),d.qZA(),d.TgZ(34,"td",40),d.TgZ(35,"span",37),d._uU(36),d.ALo(37,"translate"),d.qZA(),d._uU(38),d.ALo(39,"currency"),d.qZA(),d.TgZ(40,"td",40),d.TgZ(41,"span",37),d._uU(42),d.ALo(43,"translate"),d.qZA(),d._uU(44),d.ALo(45,"currency"),d.qZA(),d.qZA()}if(2&e){const e=t.$implicit,s=t.rowIndex,i=d.oxw(3);d.xp6(3),d.Oqu(d.lcZ(4,18,i.translation.egwebapps.egrSelect)),d.xp6(2),d.Q6J("binary",!0)("ngModel",e.isChecked),d.xp6(1),d.Q6J("ngIf",i.isNonPersistedEnabled),d.xp6(3),d.Oqu(d.lcZ(10,20,i.translation.egwebapps.egrAA)),d.xp6(2),d.hij(" ",s+1," "),d.xp6(3),d.Oqu(d.lcZ(15,22,i.translation.egwebapps.egrXK)),d.xp6(2),d.hij(" ",e.aaEggrafis," "),d.xp6(3),d.Oqu(d.lcZ(20,24,i.translation.egwebapps.description)),d.xp6(2),d.hij(" ",e.perigrafi," "),d.xp6(3),d.Oqu(d.lcZ(25,26,i.translation.egwebapps.egrExpDate)),d.xp6(2),d.hij(" ",d.xi3(27,28,e.hmerominiaLixis,"dd/LL/yyyy")," "),d.xp6(4),d.Oqu(d.lcZ(31,31,i.translation.epayments.netPoso)),d.xp6(2),d.hij(" ",d.gM2(33,33,e.currentKatharoPoso,"\u20ac","symbol","1.2")," "),d.xp6(4),d.Oqu(d.lcZ(37,38,i.translation.egwebapps.egrOngoingCharges)),d.xp6(2),d.hij(" ",d.gM2(39,40,e.currentProsafksisi+e.currentKrathseis,"\u20ac","symbol","1.2")," "),d.xp6(4),d.Oqu(d.lcZ(43,45,i.translation.egwebapps.egrTotalCost)),d.xp6(2),d.hij(" ",d.gM2(45,47,e.currentSynolo,"\u20ac","symbol","1.2")," ")}}function I(e,t){if(1&e&&(d.TgZ(0,"tr"),d.TgZ(1,"td"),d._uU(2," \u0394\u03b5\u03bd \u03b2\u03c1\u03ad\u03b8\u03b7\u03ba\u03b1\u03bd \u03b5\u03b3\u03b3\u03c1\u03b1\u03c6\u03ad\u03c2. "),d.qZA(),d.qZA()),2&e){const e=d.oxw(3);d.xp6(1),d.uIk("colspan",e.isNonPersistedEnabled?9:8)}}function E(e,t){if(1&e&&(d.TgZ(0,"td",45),d.TgZ(1,"strong"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.qZA()),2&e){const e=d.oxw(4);d.xp6(2),d.AsE("",d.lcZ(3,2,e.translation.egwebapps.egrTotal),": ",null==e.filteredDebits.entries?null:e.filteredDebits.entries.length,"")}}function N(e,t){if(1&e&&(d.TgZ(0,"td",46),d.TgZ(1,"strong"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.qZA()),2&e){const e=d.oxw(4);d.xp6(2),d.AsE("",d.lcZ(3,2,e.translation.egwebapps.egrTotal),": ",null==e.filteredDebits.entries?null:e.filteredDebits.entries.length,"")}}function J(e,t){if(1&e&&(d.TgZ(0,"tr"),d.YNc(1,E,4,4,"td",42),d.YNc(2,N,4,4,"td",43),d.TgZ(3,"td",44),d.TgZ(4,"strong"),d._uU(5),d.ALo(6,"currency"),d.qZA(),d.qZA(),d.TgZ(7,"td",44),d.TgZ(8,"strong"),d._uU(9),d.ALo(10,"currency"),d.qZA(),d.qZA(),d.TgZ(11,"td",44),d.TgZ(12,"strong"),d._uU(13),d.ALo(14,"currency"),d.qZA(),d.qZA(),d.qZA()),2&e){const e=d.oxw(3);d.xp6(1),d.Q6J("ngIf",!e.isNonPersistedEnabled),d.xp6(1),d.Q6J("ngIf",e.isNonPersistedEnabled),d.xp6(3),d.Oqu(d.gM2(6,5,e.totalCurrentKatharo,"\u20ac","symbol","1.2")),d.xp6(4),d.Oqu(d.gM2(10,10,e.totalCurrentProsafksisi,"\u20ac","symbol","1.2")),d.xp6(4),d.Oqu(d.gM2(14,15,e.totalcurrentSynolo,"\u20ac","symbol","1.2"))}}function Y(e,t){if(1&e){const e=d.EpF();d.ynx(0),d.YNc(1,v,2,1,"div",7),d.YNc(2,O,5,6,"form",8),d.TgZ(3,"p-table",9),d.NdJ("sortFunction",function(t){return d.CHM(e),d.oxw(2)._customSort(t)}),d.YNc(4,L,9,6,"ng-template",10),d.YNc(5,U,29,24,"ng-template",11),d.YNc(6,P,46,52,"ng-template",12),d.YNc(7,I,3,1,"ng-template",13),d.YNc(8,J,15,20,"ng-template",14),d.qZA(),d.TgZ(9,"p"),d.TgZ(10,"small"),d.TgZ(11,"em"),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.qZA(),d.qZA(),d.BQk()}if(2&e){const e=d.oxw(2);d.xp6(1),d.Q6J("ngIf",e.calculatedChecked.countChecked>0),d.xp6(1),d.Q6J("ngIf",e.isNonPersistedEnabled),d.xp6(1),d.Q6J("value",e.filteredDebits.entries)("lazy",!1)("lazyLoadOnInit",!1)("rowHover",!0)("paginator",!0)("alwaysShowPaginator",!1)("rows",10)("loading",e.isLoading)("totalRecords",null==e.filteredDebits.entries?null:e.filteredDebits.entries.length)("customSort",!0),d.xp6(9),d.hij("* ",d.lcZ(13,13,e.translation.egwebapps.egrOngoingChargesAndDeductions),"")}}function Q(e,t){if(1&e&&(d.TgZ(0,"div"),d.YNc(1,q,1,2,"p-message",1),d.YNc(2,D,1,1,"p-message",5),d.YNc(3,Y,14,15,"ng-container",2),d.qZA()),2&e){const e=d.oxw();d.xp6(1),d.Q6J("ngIf",e.filteredDebits.entries&&e.filteredDebits.entries.length&&0==e.calculatedChecked.countChecked&&e.debits.entries),d.xp6(1),d.Q6J("ngIf",e.filteredDebits.entries&&0==e.filteredDebits.entries.length),d.xp6(1),d.Q6J("ngIf",e.filteredDebits.entries)}}function B(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",47),d.TgZ(1,"div"),d.TgZ(2,"p",48),d._uU(3),d.ALo(4,"translate"),d.TgZ(5,"span",49),d._uU(6),d.ALo(7,"translate"),d.ALo(8,"translate"),d.qZA(),d.qZA(),d.TgZ(9,"p",48),d._uU(10),d.ALo(11,"translate"),d.TgZ(12,"span",49),d._uU(13),d.ALo(14,"currency"),d.qZA(),d.qZA(),d.TgZ(15,"p",48),d._uU(16),d.ALo(17,"translate"),d.TgZ(18,"span",49),d._uU(19),d.ALo(20,"currency"),d.qZA(),d.qZA(),d.TgZ(21,"p",48),d._uU(22),d.ALo(23,"translate"),d.TgZ(24,"span",50),d._uU(25),d.ALo(26,"currency"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(27,"app-checkout",51),d.NdJ("onPayBtnClick",function(t){return d.CHM(e),d.oxw().onCreatePaymentRequest(t)}),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.xp6(3),d.hij("",d.lcZ(4,14,e.translation.egwebapps.egrSelected)," "),d.xp6(3),d.AsE("",e.calculatedChecked.countChecked," ",1==e.calculatedChecked.countChecked?d.lcZ(7,16,e.translation.epayments.debit):d.lcZ(8,18,e.translation.epayments.debits),""),d.xp6(4),d.hij("",d.lcZ(11,20,e.translation.epayments.netPoso),": "),d.xp6(3),d.Oqu(d.gM2(14,22,e.calculatedChecked.checkedKatharo,"\u20ac","symbol","1.2")),d.xp6(3),d.hij("",d.lcZ(17,27,e.translation.egwebapps.egrOngoingCharges),": "),d.xp6(3),d.Oqu(d.gM2(20,29,e.calculatedChecked.checkedEpivarinseis,"\u20ac","symbol","1.2")),d.xp6(3),d.hij("",d.lcZ(23,34,e.translation.epayments.totalChecked),": "),d.xp6(3),d.Oqu(d.gM2(26,36,e.calculatedChecked.checkedSum,"\u20ac","symbol","1.2")),d.xp6(2),d.Q6J("isPaymentFormValid",!0)("doPaymentSubscription",e.onDoPaymentSubject.asObservable())("finApiUrl",e.financeApiUrl)("buttonText",e.translation.egwebapps.egrPaymentBtnText)("cancelButtonText",e.translation.egwebapps.egrCancelBtn)}}let F=(()=>{class e{constructor(e,t,s,i,n,a,r){this.toasterSrv=e,this.oidcSecuritySrv=t,this.epaymentsSrv=s,this.egPaymentSrv=i,this.appCacheSv=n,this.cdr=a,this._parent=r,this.countriesList=[],this.onDoPaymentSubject=new l.xQ,this.isMobile=!1,this.bankStatusMessage=null,this.calculatedChecked={countChecked:0,countText:"\u03bf\u03c6\u03b5\u03b9\u03bb\u03ad\u03c2",checkedSum:0,checkedKatharo:0,checkedProsafksisis:0},this.isAllDebitsChecked=!1,this.isLoading=!0,this.eidosDebit=[],this.selectedEidosId=0,this.onDestroy=new l.xQ,this.oikonomikiBankMessagesEn=y.Px}ngOnInit(){this.appCacheSv.translation$.pipe((0,p.R)(this.onDestroy)).subscribe(e=>{e&&(this.translation=e,(0,o.RA)(this.cdr))}),this.appCacheSv.selectedLang$.pipe((0,p.R)(this.onDestroy)).subscribe(e=>{if(e)switch(this.selectedLang=e,e){case"en":this.eidosDebit=[{value:0,perigrafi:"All"},{value:1,perigrafi:"Persisted Debits"},{value:2,perigrafi:"Non Persisted Debits"}];break;default:this.eidosDebit=[{value:0,perigrafi:"\u038c\u03bb\u03b5\u03c2"},{value:1,perigrafi:"\u0392\u03b5\u03b2\u03b1\u03b9\u03c9\u03bc\u03ad\u03bd\u03b5\u03c2 \u039f\u03c6\u03b5\u03b9\u03bb\u03ad\u03c2"},{value:2,perigrafi:"\u039c\u03b7 \u0392\u03b5\u03b2\u03b1\u03b9\u03c9\u03bc\u03ad\u03bd\u03b5\u03c2 \u039f\u03c6\u03b5\u03b9\u03bb\u03ad\u03c2"}]}}),this.isMobile=this._parent.isMobile,this.isNonPersistedEnabled=AppConfOptions.show_non_persisted_debits,"undefined"!=typeof AuthConfOptions&&AppConfOptions&&AppConfOptions.epayments_api&&(this.financeApiUrl=(0,o.Qj)(AppConfOptions.epayments_api));let e=`${(0,o.Qj)(AuthConfOptions.stsServer)}/api/general/GetCountries`;this.appCacheSv.initCountries(e),this.appCacheSv.countries$.pipe((0,p.R)(this.onDestroy)).subscribe(e=>this.countriesList=e),this.oidcSecuritySrv.userData$.pipe((0,p.R)(this.onDestroy)).subscribe(e=>{e&&(this.user=e)}),this._initDebitsByTin()}ngOnDestroy(){this.onDestroy.next(null)}onCreatePaymentRequest(e){if((0,o.Ew)(this.user.email))this.toasterSrv.showWarning("","\u0395\u03af\u03bd\u03b1\u03b9 \u03b1\u03c0\u03b1\u03c1\u03b1\u03af\u03c4\u03b7\u03c4\u03bf \u03c4\u03bf email \u03c3\u03b1\u03c2 \u03c3\u03c4\u03b7 \u03c3\u03b5\u03bb\u03af\u03b4\u03b1 \u03c4\u03bf\u03c5 \u03c0\u03c1\u03bf\u03c6\u03af\u03bb \u03c3\u03b1\u03c2.");else{this.paymentRequestDto=void 0,(0,o.RA)(this.cdr);let t=this.filteredDebits.entries.filter(e=>e.isChecked);if(t&&t.length){let s={tinRelated:this.user.tin,relatedCallbackUrl:AppConfOptions.application_url+"/epayments/receipts",billingAddressCity:this.user.address_city,billingAddressCountryCode:this.user.address_country_code,billingAddressZip:this.user.address_zip,billingAddress:this.user.address,userEmail:this.user.email,userPhone:this.user.phone_number,paymentMethodKey:e.key,entries:[]};"PIRBGRAA"===e.key&&(s.billingAddressCountryCode=null);for(let e of t.filter(e=>e.isChecked)){let t={remittanceInfo:this._createRemittanceInfo(e),amount:e.currentSynolo,debtorName:e.eponymia,tin:this.user.tin,description:e.perigrafi,metadata:e.metadata};s.entries.push(t)}this.paymentRequestDto=s,(0,o.RA)(this.cdr),this.egPaymentSrv.addPaymentRequest(this.financeApiUrl,this.paymentRequestDto).subscribe(e=>{e?(this.paymentResponseDto=e,this.onDoPaymentSubject.next(this.paymentResponseDto)):this.toasterSrv.showError("",this.translation.egwebapps.egrPaymentProblemFound)})}}}onAllDebitsSelected(){this.filteredDebits.entries.forEach(e=>{e.isChecked=this.isAllDebitsChecked}),(0,o.RA)(this.cdr),this._calculateTotalAmounts()}onSelectedPersistedTypeChanged(e){this.selectedEidosId=+e,this.filteredDebits=(0,o.p$)(this.debits),this.filteredDebits.entries=1===this.selectedEidosId?this.debits.entries.filter(e=>!0===e.isBebaiomeno):2===this.selectedEidosId?this.debits.entries.filter(e=>!1===e.isBebaiomeno):this.debits.entries,(0,o.RA)(this.cdr),this._fillDebitsTable(this.filteredDebits)}_initDebitsByTin(){if(this.isLoading=!0,(0,o.RA)(this.cdr),this.user){this.countriesList&&this.user.address_country_code&&""!=this.user.address_country_code&&(this.user.address_country_num=this.countriesList.find(e=>e.Alpha2Code==this.user.address_country_code).NumericCode.toString()),this.user.email=(0,o.Ew)(this.user.email)?this.user.email:this.user.email.trim(),this.user.username=(0,o.Ew)(this.user.username)?this.user.username:this.user.username.trim(),this.user.tin=(0,o.Ew)(this.user.tin)?this.user.tin:this.user.tin.trim(),this.user.family_name=(0,o.Ew)(this.user.family_name)?this.user.family_name:this.user.family_name.trim(),this.user.given_name=(0,o.Ew)(this.user.given_name)?this.user.given_name:this.user.given_name.trim(),this.user.fathers_name=(0,o.Ew)(this.user.fathers_name)?this.user.fathers_name:this.user.fathers_name.trim(),this.user.mothers_name=(0,o.Ew)(this.user.mothers_name)?this.user.mothers_name:this.user.mothers_name.trim(),this.user.name=(0,o.Ew)(this.user.name)?this.user.name:this.user.name.trim(),this.user.address_city=(0,o.Ew)(this.user.address_city)?this.user.address_city:this.user.address_city.trim(),this.user.address_country_code=(0,o.Ew)(this.user.address_country_code)?this.user.address_country_code:this.user.address_country_code.trim(),this.user.address_country_num=(0,o.Ew)(this.user.address_country_num)?this.user.address_country_num:this.user.address_country_num.trim(),this.user.address_zip=(0,o.Ew)(this.user.address_zip)?this.user.address_zip:this.user.address_zip.trim(),this.user.address=(0,o.Ew)(this.user.address)?this.user.address:this.user.address.trim(),this.user.adt=(0,o.Ew)(this.user.adt)?this.user.adt:this.user.adt.trim(),this.user.phone_number=(0,o.Ew)(this.user.phone_number)?this.user.phone_number:this.user.phone_number.trim();let e={tin:this.user.tin};this.epaymentsSrv.getBankMessages().pipe((0,b.w)(t=>(this.oikonomikiBankMessages=t,this.epaymentsSrv.getDebitsByTin(e)))).subscribe(e=>{e&&(e.entries&&e.entries.length>=0?(this.debits=e,this._fillDebitsTable(this.debits)):(e.message||e.messageId)&&(this.bankStatusMessage="el"==this.selectedLang?this.oikonomikiBankMessages[e.messageId]?this.oikonomikiBankMessages[e.messageId]:e.message:this.oikonomikiBankMessagesEn[e.messageId]?this.oikonomikiBankMessagesEn[e.messageId]:e.message,this.toasterSrv.showError("",this.bankStatusMessage)),this.isLoading=!1)})}else this.toasterSrv.showError("","\u03a5\u03c0\u03ae\u03c1\u03be\u03b5 \u03ba\u03ac\u03c0\u03bf\u03b9\u03bf \u03c0\u03c1\u03cc\u03b2\u03bb\u03b7\u03bc\u03b1 \u03bc\u03b5 \u03c4\u03b7\u03bd \u03b1\u03bd\u03ac\u03ba\u03c4\u03b7\u03c3\u03b7 \u03c4\u03c9\u03bd \u03c3\u03c4\u03bf\u03b9\u03c7\u03b5\u03af\u03c9\u03bd \u03c7\u03c1\u03ae\u03c3\u03c4\u03b7.")}_fillDebitsTable(e){if(this.isLoading=!0,(0,o.RA)(this.cdr),e.statusCode==o.WE.Error)return this.toasterSrv.showWarning("",this.translation.epayments.duplicateTin),void(this.bankStatusMessage=this.translation.epayments.duplicateTin);if(e.statusCode==o.WE.UndefinedError)return this.toasterSrv.showWarning("",this.translation.epayments.loadPaymentsError),void(this.bankStatusMessage=this.translation.epayments.loadPaymentsError);0===e.entries.length&&(this.bankStatusMessage=this.translation.epayments.noDebitsFound),!1===this.isNonPersistedEnabled&&(e.entries=e.entries.filter(e=>!0===e.isBebaiomeno)),e.entries.forEach(e=>{e.isChecked=!1});let t=e.entries.map(e=>e.currentKatharoPoso);this.totalCurrentKatharo=t.reduce((e,t)=>e+t,0);let s=e.entries.map(e=>e.currentProsafksisi),i=e.entries.map(e=>e.currentKrathseis);this.totalCurrentProsafksisi=s.reduce((e,t)=>e+t,0)+i.reduce((e,t)=>e+t,0);let n=e.entries.map(e=>e.currentSynolo);this.totalcurrentSynolo=n.reduce((e,t)=>e+t,0),e.entries.sort(function(e,t){return Date.parse(e.hmerominiaLixis)/1e3-Date.parse(t.hmerominiaLixis)/1e3}),this.filteredDebits=e,this.isLoading=!1,(0,o.RA)(this.cdr)}_calculateTotalAmounts(){let e=0,t=0,s=0,i=0,n=this.translation.epayments.debits;this.filteredDebits.entries.forEach(n=>{n.isChecked&&(i++,e+=n.currentSynolo,t+=n.currentKatharoPoso,s+=n.currentProsafksisi+n.currentKrathseis)}),n=1==i?this.translation.epayments.debit:this.translation.epayments.debits,this.calculatedChecked={countChecked:i,countText:n,checkedSum:e,checkedKatharo:t,checkedEpivarinseis:s}}_createRemittanceInfo(e){return e.remittanceInfo}_customSort(e){if(e.hasOwnProperty("field"))switch(e.field){case"hmerominiaLixis":this.filteredDebits.entries=e.hasOwnProperty("order")&&1==e.order?this.filteredDebits.entries.sort(function(e,t){return+new Date(t.hmerominiaLixis)-+new Date(e.hmerominiaLixis)>0?1:-1}):this.filteredDebits.entries.sort(function(e,t){return+new Date(t.hmerominiaLixis)-+new Date(e.hmerominiaLixis)<0?1:-1});break;default:this.filteredDebits.entries=e.hasOwnProperty("order")&&1==e.order?this.filteredDebits.entries.sort(function(t,s){return+s[e.field]-+t[e.field]>0?1:-1}):this.filteredDebits.entries.sort(function(t,s){return+s[e.field]-+t[e.field]<0?1:-1})}}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(o.MJ),d.Y36(c.J_),d.Y36(Z.C),d.Y36(o.te),d.Y36(h.g),d.Y36(d.sBO),d.Y36(_.y))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-debits"]],inputs:{isAuthorized:"isAuthorized"},decls:5,vars:4,consts:[[3,"condition","customClass"],["severity","warn",3,"text","styleClass",4,"ngIf"],[4,"ngIf"],["selectedDebits",""],["severity","warn",3,"text","styleClass"],["severity","warn","text","\u0394\u03b5\u03bd \u03b2\u03c1\u03ad\u03b8\u03b7\u03ba\u03b1\u03bd \u03b5\u03b3\u03b3\u03c1\u03b1\u03c6\u03ad\u03c2.",3,"styleClass",4,"ngIf"],["severity","warn","text","\u0394\u03b5\u03bd \u03b2\u03c1\u03ad\u03b8\u03b7\u03ba\u03b1\u03bd \u03b5\u03b3\u03b3\u03c1\u03b1\u03c6\u03ad\u03c2.",3,"styleClass"],["class","debits-info__selected-debits",4,"ngIf"],["class","form mb-1",4,"ngIf"],["responsiveLayout","stack","breakpoint","1070px",3,"value","lazy","lazyLoadOnInit","rowHover","paginator","alwaysShowPaginator","rows","loading","totalRecords","customSort","sortFunction"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","footer"],[1,"debits-info__selected-debits"],[4,"ngTemplateOutlet"],[1,"form","mb-1"],["name","perstType","bindLabel","perigrafi","bindValue","value",3,"items","ngModel","clearable","ngModelChange"],[1,"ui-helper-clearfix",2,"text-align","left"],[1,"mr-1"],[1,"far","fa-dot-circle","fa-fw","text-success"],[1,"fas","fa-dot-circle","fa-fw","text-warning"],[1,"fixed-width-col-40","text-center"],[3,"binary","ngModel","ngModelChange","onChange"],["class","fixed-width-col-40",4,"ngIf"],[1,"fixed-width-col-40"],[1,"fixed-width-col-120"],[1,"fixed-width-col-170"],["pSortableColumn","hmerominiaLixis",1,"fixed-width-col-100"],["field","hmerominiaLixis"],["pSortableColumn","currentKatharoPoso",1,"fixed-width-col-120"],["field","currentKatharoPoso"],["pSortableColumn","currentProsafksisi",1,"fixed-width-col-120"],["field","currentProsafksisi"],["pSortableColumn","currentSynolo",1,"fixed-width-col-120"],["field","currentSynolo"],[1,"p-column-title"],["class","fixed-width-col-40 text-center",4,"ngIf"],[1,"fixed-width-col-100","text-center"],[1,"fixed-width-col-120","text-right"],["aria-hidden","true",1,"fa-fw",3,"ngClass"],["class","fixed-width-col-470","colspan","5",4,"ngIf"],["class","fixed-width-col-510","colspan","6",4,"ngIf"],["colspan","1",1,"fixed-width-col-100","text-right"],["colspan","5",1,"fixed-width-col-470"],["colspan","6",1,"fixed-width-col-510"],[1,"debits-info","d-flex","flex-wrap","justify-content-around","w-100","align-items-center","mb-1"],[1,"mb-0"],[1,"totalPoso"],["id","sumTotalToBank",1,"totalPoso"],[3,"isPaymentFormValid","doPaymentSubscription","finApiUrl","buttonText","cancelButtonText","onPayBtnClick"]],template:function(e,t){1&e&&(d._UZ(0,"lib-egr-loading",0),d.YNc(1,k,1,2,"p-message",1),d.YNc(2,Q,4,3,"div",2),d.YNc(3,B,28,41,"ng-template",null,3,d.W1O)),2&e&&(d.Q6J("condition",t.isLoading)("customClass","egr-load-small"),d.xp6(1),d.Q6J("ngIf",t.bankStatusMessage),d.xp6(1),d.Q6J("ngIf",t.filteredDebits&&!t.isLoading))},directives:[o.IE,u.O5,g.q,A.iA,x.jx,u.tP,w._Y,w.JL,w.F,T.w9,w.JJ,w.On,C.XZ,A.lQ,A.fz,u.mk,o.Hl],pipes:[n.X$,u.uU,u.H9],encapsulation:2}),e})();var j=s(24663),z=s(23815),$=s(25917),H=s(40205),K=s(88598);function W(e,t){if(1&e&&d._UZ(0,"p-message",23),2&e){const e=d.oxw();d.Q6J("text",e.receiptsMessage)}}function V(e,t){if(1&e&&d._UZ(0,"p-message",24),2&e){const e=d.oxw();d.Q6J("severity",e.bankStatusMessageClass)("text",e.bankStatusMessage)("styleClass","mb-2")}}function X(e,t){if(1&e&&(d.TgZ(0,"div",25),d.TgZ(1,"span",26),d._UZ(2,"i",27),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"span",26),d._UZ(6,"i",28),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.qZA()),2&e){const e=d.oxw();d.xp6(3),d.hij(" ",d.lcZ(4,2,e.translation.epayments.waiverOnline),""),d.xp6(4),d.hij(" ",d.lcZ(8,4,e.translation.epayments.waiverOffline),"")}}function G(e,t){if(1&e&&(d.TgZ(0,"th",30),d._uU(1),d.ALo(2,"translate"),d.qZA()),2&e){const e=d.oxw(2);d.xp6(1),d.Oqu(d.lcZ(2,1,e.translation.epayments.receipt))}}function ee(e,t){if(1&e&&(d.TgZ(0,"tr"),d.TgZ(1,"th",29),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"th",30),d._uU(5),d.ALo(6,"translate"),d.qZA(),d.TgZ(7,"th",31),d._uU(8),d.ALo(9,"translate"),d._UZ(10,"p-sortIcon",32),d.qZA(),d.TgZ(11,"th",30),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.TgZ(14,"th",33),d._uU(15),d.ALo(16,"translate"),d._UZ(17,"p-sortIcon",34),d.qZA(),d.TgZ(18,"th",35),d._uU(19),d.ALo(20,"translate"),d.qZA(),d.TgZ(21,"th",36),d._uU(22),d.ALo(23,"translate"),d.qZA(),d.YNc(24,G,3,3,"th",37),d.qZA()),2&e){const e=d.oxw();d.xp6(2),d.Oqu(d.lcZ(3,8,e.translation.egwebapps.egrType)),d.xp6(3),d.Oqu(d.lcZ(6,10,e.translation.epayments.receiptNbr)),d.xp6(3),d.hij("",d.lcZ(9,12,e.translation.epayments.receiptDate)," "),d.xp6(4),d.Oqu(d.lcZ(13,14,e.translation.epayments.transactionNbr)),d.xp6(3),d.hij("",d.lcZ(16,16,e.translation.epayments.transactionDate)," "),d.xp6(4),d.Oqu(d.lcZ(20,18,e.translation.egwebapps.description)),d.xp6(3),d.Oqu(d.lcZ(23,20,e.translation.epayments.poso)),d.xp6(2),d.Q6J("ngIf",!(null!=e.paymentsSettings&&e.paymentsSettings.isProviderThirdParty))}}function te(e,t){if(1&e&&(d.TgZ(0,"a",46),d._UZ(1,"i",47),d.qZA()),2&e){const e=d.oxw(2).$implicit,t=d.oxw();d.hYB("href","",t.financeApiUrl,"/api/PersistedDebits/GetPaymentFile/",e.bankTxnUid,"",d.LSH)}}function se(e,t){if(1&e&&(d.TgZ(0,"td",44),d.TgZ(1,"span",39),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.YNc(4,te,2,2,"a",45),d.qZA()),2&e){const e=d.oxw().$implicit,t=d.oxw();d.xp6(2),d.Oqu(d.lcZ(3,2,t.translation.epayments.receipt)),d.xp6(2),d.Q6J("ngIf",e.receiptId&&e.bankTxnUid)}}function ie(e,t){if(1&e&&(d.TgZ(0,"tr"),d.TgZ(1,"td",38),d.TgZ(2,"span",39),d._uU(3),d.ALo(4,"translate"),d.qZA(),d._UZ(5,"i",40),d.qZA(),d.TgZ(6,"td",30),d.TgZ(7,"span",39),d._uU(8),d.ALo(9,"translate"),d.qZA(),d._uU(10),d.qZA(),d.TgZ(11,"td",41),d.TgZ(12,"span",39),d._uU(13),d.ALo(14,"translate"),d.qZA(),d._uU(15),d.ALo(16,"date"),d.qZA(),d.TgZ(17,"td",30),d.TgZ(18,"span",39),d._uU(19),d.ALo(20,"translate"),d.qZA(),d._uU(21),d.qZA(),d.TgZ(22,"td",41),d.TgZ(23,"span",39),d._uU(24),d.ALo(25,"translate"),d.qZA(),d._uU(26),d.ALo(27,"date"),d.qZA(),d.TgZ(28,"td",35),d.TgZ(29,"span",39),d._uU(30),d.ALo(31,"translate"),d.qZA(),d._uU(32),d.qZA(),d.TgZ(33,"td",42),d.TgZ(34,"span",39),d._uU(35),d.ALo(36,"translate"),d.qZA(),d._uU(37),d.ALo(38,"currency"),d.qZA(),d.YNc(39,se,5,4,"td",43),d.qZA()),2&e){const e=t.$implicit,s=d.oxw();d.xp6(3),d.Oqu(d.lcZ(4,17,s.translation.egwebapps.egrType)),d.xp6(2),d.Tol(e.icon),d.xp6(3),d.Oqu(d.lcZ(9,19,s.translation.epayments.receiptNbr)),d.xp6(2),d.hij(" ",e.receiptIncrNr," "),d.xp6(3),d.Oqu(d.lcZ(14,21,s.translation.epayments.receiptDate)),d.xp6(2),d.hij(" ",d.xi3(16,23,e.receiptDateCreated,"dd/LL/yyyy")," "),d.xp6(4),d.Oqu(d.lcZ(20,26,s.translation.epayments.transactionNbr)),d.xp6(2),d.hij(" ",e.bankTxnPaymentRef," "),d.xp6(3),d.Oqu(d.lcZ(25,28,s.translation.epayments.transactionDate)),d.xp6(2),d.hij(" ",d.xi3(27,30,e.bankTxnDateCreated,"dd/LL/yyyy")," "),d.xp6(4),d.Oqu(d.lcZ(31,33,s.translation.egwebapps.description)),d.xp6(2),d.hij(" ",e.description," "),d.xp6(3),d.Oqu(d.lcZ(36,35,s.translation.epayments.poso)),d.xp6(2),d.hij(" ",d.gM2(38,37,e.paymentTotal,"\u20ac","symbol","1.2")," "),d.xp6(2),d.Q6J("ngIf",!(null!=s.paymentsSettings&&s.paymentsSettings.isProviderThirdParty))}}function ne(e,t){if(1&e&&(d.TgZ(0,"tr"),d.TgZ(1,"td"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.qZA()),2&e){const e=d.oxw();d.xp6(1),d.uIk("colspan",null!=e.paymentsSettings&&e.paymentsSettings.isProviderThirdParty?7:8),d.xp6(1),d.hij(" ",d.lcZ(3,2,e.translation.egwebapps.egrNoResultsFound)," ")}}function ae(e,t){if(1&e&&(d.TgZ(0,"tr"),d.TgZ(1,"td",48),d.TgZ(2,"strong"),d._uU(3),d.qZA(),d.qZA(),d.TgZ(4,"td",49),d.TgZ(5,"strong"),d._uU(6),d.ALo(7,"translate"),d.ALo(8,"currency"),d.qZA(),d.qZA(),d.qZA()),2&e){const e=d.oxw();d.xp6(3),d.hij("\u03a0\u03bb\u03ae\u03b8\u03bf\u03c2: ",null==e.orderedReceiptsFiltered?null:e.orderedReceiptsFiltered.length,""),d.xp6(1),d.Q6J("ngClass",null!=e.paymentsSettings&&e.paymentsSettings.isProviderThirdParty?"fixed-width-col-120":"fixed-width-col-220"),d.uIk("colspan",null!=e.paymentsSettings&&e.paymentsSettings.isProviderThirdParty?1:2),d.xp6(2),d.AsE("",d.lcZ(7,5,e.translation.egwebapps.egrTotalCost),": ",d.gM2(8,7,e.totalPoso,"EUR","symbol","1.2-2"),"")}}const re=function(){return{width:"100%"}};let oe=(()=>{class e{constructor(e,t,s,i,n,a,r){this.oidcSecuritySrv=e,this.epaymentsSrv=t,this.egPaymentSrv=s,this.appCacheSv=i,this.toasterSrv=n,this.cdr=a,this.route=r,this.onDestroy=new l.xQ,this.totalPoso=0,this.bankStatusMessageClass=void 0,this.oikonomikiBankMessagesEn=y.Px,this.receiptType=0,this.isLoading=!0,this.hmerominiaApodiksisRange=null,this.hmerominiaSinallagisRange=null,this.today=new Date,this.yearRange=(0,o.ug)(50,50),this.tropoiPliromis=[]}ngOnInit(){"undefined"!=typeof AppConfOptions&&AppConfOptions&&AppConfOptions.epayments_api&&(this.financeApiUrl=(0,o.Qj)(AppConfOptions.epayments_api)),this.appCacheSv.translation$.pipe((0,p.R)(this.onDestroy)).subscribe(e=>{e&&(this.translation=e,(0,o.RA)(this.cdr))}),this.appCacheSv.selectedLang$.pipe((0,p.R)(this.onDestroy)).subscribe(e=>{if(e)switch(this.selectedLang=e,e){case"en":this.tropoiPliromis=[{value:0,perigrafi:"All"},{value:1,perigrafi:"Organization's Fund Office"},{value:2,perigrafi:"E-Services"}];break;default:this.tropoiPliromis=[{id:0,perigrafi:"\u038c\u03bb\u03bf\u03b9"},{id:1,perigrafi:"\u03a4\u03b1\u03bc\u03b5\u03af\u03bf \u0394\u03ae\u03bc\u03bf\u03c5"},{id:2,perigrafi:"Online"}]}}),this.isLoading=!0,this.egPaymentSrv.getPaymentSetting(`${this.financeApiUrl}/api/Banks/PaymentSettings`).subscribe(e=>{e&&(this.paymentsSettings=e)}),this.oidcSecuritySrv.userData$.pipe((0,p.R)(this.onDestroy)).subscribe(e=>{e&&(this.user=e,this.user.email=(0,o.Ew)(this.user.email)?this.user.email:this.user.email.trim(),this.user.username=(0,o.Ew)(this.user.username)?this.user.username:this.user.username.trim(),this.user.tin=(0,o.Ew)(this.user.tin)?this.user.tin:this.user.tin.trim(),this.user.family_name=(0,o.Ew)(this.user.family_name)?this.user.family_name:this.user.family_name.trim(),this.user.given_name=(0,o.Ew)(this.user.given_name)?this.user.given_name:this.user.given_name.trim(),this.user.fathers_name=(0,o.Ew)(this.user.fathers_name)?this.user.fathers_name:this.user.fathers_name.trim(),this.user.mothers_name=(0,o.Ew)(this.user.mothers_name)?this.user.mothers_name:this.user.mothers_name.trim(),this.user.name=(0,o.Ew)(this.user.name)?this.user.name:this.user.name.trim(),this.user.address_city=(0,o.Ew)(this.user.address_city)?this.user.address_city:this.user.address_city.trim(),this.user.address_country_code=(0,o.Ew)(this.user.address_country_code)?this.user.address_country_code:this.user.address_country_code.trim(),this.user.address_country_num=(0,o.Ew)(this.user.address_country_num)?this.user.address_country_num:this.user.address_country_num.trim(),this.user.address_zip=(0,o.Ew)(this.user.address_zip)?this.user.address_zip:this.user.address_zip.trim(),this.user.address=(0,o.Ew)(this.user.address)?this.user.address:this.user.address.trim(),this.user.adt=(0,o.Ew)(this.user.adt)?this.user.adt:this.user.adt.trim(),this.user.phone_number=(0,o.Ew)(this.user.phone_number)?this.user.phone_number:this.user.phone_number.trim())}),this.epaymentsSrv.getBankMessages().pipe((0,b.w)(e=>e?(this.oikonomikiBankMessages=e,this.route.queryParams.pipe((0,p.R)(this.onDestroy))):(0,$.of)(!1))).subscribe(e=>{if(e){let t=e;if(t.messagecode||t.paymentStatus){let e=t.messagecode?t.messagecode:t.paymentStatus;this.bankStatusMessage="el"==this.selectedLang?this.oikonomikiBankMessages[e]:this.oikonomikiBankMessagesEn[e],"TRANSACTION_COMPLETED"==e||"APPROVED"==e?(this.toasterSrv.showSuccess("",this.bankStatusMessage),this.bankStatusMessageClass="success"):(this.bankStatusMessageClass="error",this.toasterSrv.showError("",this.bankStatusMessage))}(0,o.RA)(this.cdr),this._initReceiptsByTin()}else this.toasterSrv.showError("",this.translation.egwebapps.egrProblemFound),this.isLoading=!1,(0,o.RA)(this.cdr)})}ngOnChanges(e){e&&e.tabChanged&&(this.bankStatusMessage=void 0,(0,o.RA)(this.cdr))}ngOnDestroy(){this.onDestroy.next(null)}onReceiptTypeChanged(e){this.receiptType=e,(0,o.RA)(this.cdr)}onSearch(){this.isLoading=!0,this.orderedReceiptsFiltered=(0,o.p$)(this.orderedReceipts);let e=[];if(this.hmerominiaApodiksisRange){let t=this.orderedReceiptsFiltered.filter(e=>(0,j.Z)(new Date(e.receiptDateCreated),{start:new Date(this.hmerominiaApodiksisRange[0]),end:new Date(this.hmerominiaApodiksisRange[1])}));t&&t.length&&t.forEach(t=>{e.push(t)})}if(this.hmerominiaSinallagisRange){let t=this.orderedReceiptsFiltered.filter(e=>(0,j.Z)(new Date(e.bankTxnDateCreated),{start:new Date(this.hmerominiaSinallagisRange[0]),end:new Date(this.hmerominiaSinallagisRange[1])}));t&&t.length&&t.forEach(t=>{e.push(t)})}!this.hmerominiaApodiksisRange&&!this.hmerominiaSinallagisRange&&(e=(0,o.p$)(this.orderedReceipts)),this.orderedReceiptsFiltered=z.intersection(e),(0,o.RA)(this.cdr),this._filterByType(this.orderedReceiptsFiltered)}onClear(){this.orderedReceiptsFiltered=(0,o.p$)(this.orderedReceipts),this.hmerominiaApodiksisRange=null,this.hmerominiaSinallagisRange=null,this.receiptType=0,(0,o.RA)(this.cdr)}_initReceiptsByTin(){this.isLoading=!0;let e=new Date,t={tin:this.user.tin,year:e.getFullYear()};this.epaymentsSrv.getPaymentsByTin(t).subscribe(e=>{e&&(this.receipts=e,this.totalPoso=0,this.receipts.entries&&this.receipts.entries.length>0&&this.receipts.entries.forEach(e=>{this.totalPoso+=e.receiptAmount}),!this.receipts.statusCode||2!=this.receipts.statusCode&&3!=this.receipts.statusCode?1==this.receipts.statusCode&&0==this.receipts.entries.length?this.receiptsMessage=this.translation.epayments.revDebtorNotFound:this._fillOrderedReceipts():this.receipts.responseMetadata.metadata.hasOwnProperty("REV_DEPTOR_NOT_FOUND")?(this.toasterSrv.showWarning("",this.translation.epayments.revDebtorNotFound),this.receiptsMessage=this.translation.epayments.revDebtorNotFound):this.receipts.responseMetadata.metadata.hasOwnProperty("REV_MULTIPLE_DEPTORS_FOUND")&&(this.toasterSrv.showError("error",this.translation.epayments.duplicateTin),this.receiptsMessage=this.translation.epayments.duplicateTin)),this.isLoading=!1,(0,o.RA)(this.cdr)})}_filterByType(e){e&&(2===this.receiptType?this.orderedReceiptsFiltered=e.filter(e=>!0===e.isOnline):1===this.receiptType&&(this.orderedReceiptsFiltered=e.filter(e=>!1===e.isOnline||!e.isOnline))),this.isLoading=!1,(0,o.RA)(this.cdr)}_fillOrderedReceipts(){this.orderedReceipts=z.orderBy(this.receipts.entries,["receiptDateCreated","bankTxnDateCreated","id"],["desc","desc","desc"]),this.orderedReceipts.forEach(e=>{!e.receiptDateCreated&&!e.bankTxnDateCreated&&this.orderedReceipts.unshift(e)}),this.orderedReceipts.forEach(e=>{e.icon=0==e.isOnline?"far fa-building":"fas fa-desktop",e.description=null==e.bankTxnDescr?e.receiptDescr:e.bankTxnDescr,e.paymentTotal=null==e.bankTxnPaymentTotal?e.receiptAmount:e.bankTxnPaymentTotal,e.link=null!=e.receiptId&&null!=e.bankTxnUid?'<a href="'+AppConfOptions.epayments_api+"/api/PersistedDebits/GetPaymentFile/"+e.bankTxnUid+'" target="_blank"><i class="far fa-file-pdf"></i></a>':""}),this.orderedReceiptsFiltered=(0,o.p$)(this.orderedReceipts),(0,o.RA)(this.cdr)}handleError(e){return(0,H._)(e.message)}_customSort(e){if(e.hasOwnProperty("field"))switch(e.field){case"receiptDateCreated":this.orderedReceiptsFiltered=e.hasOwnProperty("order")&&1==e.order?this.orderedReceiptsFiltered.sort(function(e,t){return+new Date(t.receiptDateCreated)-+new Date(e.receiptDateCreated)>0?1:-1}):this.orderedReceiptsFiltered.sort(function(e,t){return+new Date(t.receiptDateCreated)-+new Date(e.receiptDateCreated)<0?1:-1});break;case"bankTxnDateCreated":this.orderedReceiptsFiltered=e.hasOwnProperty("order")&&1==e.order?this.orderedReceiptsFiltered.sort(function(e,t){return+new Date(t.bankTxnDateCreated)-+new Date(e.bankTxnDateCreated)>0?1:-1}):this.orderedReceiptsFiltered.sort(function(e,t){return+new Date(t.bankTxnDateCreated)-+new Date(e.bankTxnDateCreated)<0?1:-1});break;default:this.orderedReceiptsFiltered=e.hasOwnProperty("order")&&1==e.order?this.receipts.entries.sort(function(e,t){return t.receiptIncrNr&&e.receiptIncrNr&&parseInt(t.receiptIncrNr.split("/").pop())-parseInt(e.receiptIncrNr.split("/").pop())<0?1:-1}):this.receipts.entries.sort(function(e,t){return t.receiptIncrNr&&e.receiptIncrNr&&parseInt(t.receiptIncrNr.split("/").pop())-parseInt(e.receiptIncrNr.split("/").pop())>0?1:-1})}}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(c.J_),d.Y36(Z.C),d.Y36(o.te),d.Y36(h.g),d.Y36(o.MJ),d.Y36(d.sBO),d.Y36(r.gz))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-receipts"]],inputs:{tabChanged:"tabChanged"},features:[d.TTD],decls:35,vars:59,consts:[["severity","warn",3,"text",4,"ngIf"],[3,"severity","text","styleClass",4,"ngIf"],[3,"header","styleClass"],[1,"form"],[1,"row"],[1,"form-group","col-12","col-sm-6","col-md-4"],["for","hmerominiaApodiksisRange"],["name","hmerominiaApodiksisRange","dateFormat","dd/mm/yy","placeholder","\u03b7\u03b7/\u03bc\u03bc/\u03c7\u03c7\u03c7\u03c7","selectionMode","range","appendTo","body",3,"baseZIndex","firstDayOfWeek","selectOtherMonths","monthNavigator","yearNavigator","yearRange","showIcon","showButtonBar","readonlyInput","ngModel","ngModelChange"],["for","exchangeDatepicker"],["name","hmerominiaSinallagisRange","dateFormat","dd/mm/yy","placeholder","\u03b7\u03b7/\u03bc\u03bc/\u03c7\u03c7\u03c7\u03c7","selectionMode","range","appendTo","body",3,"baseZIndex","firstDayOfWeek","selectOtherMonths","monthNavigator","yearNavigator","yearRange","showIcon","showButtonBar","readonlyInput","ngModel","ngModelChange"],["for","recType"],["name","recType","bindLabel","perigrafi","bindValue","value",3,"items","ngModel","searchable","clearable","ngModelChange"],[1,"form-buttons","d-flex","flex-wrap"],["type","button",1,"btn","btn-primary","btn-sm","mr-1",3,"click"],["aria-hidden","true",1,"fas","fa-search","fa-fw"],["type","button",1,"btn","btn-warning","btn-sm","text-white",3,"click"],["aria-hidden","true",1,"fas","fa-times","fa-fw"],["responsiveLayout","stack","breakpoint","1070px",3,"value","lazy","lazyLoadOnInit","rowHover","paginator","alwaysShowPaginator","rows","loading","totalRecords","customSort","sortFunction"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","footer"],["severity","warn",3,"text"],[3,"severity","text","styleClass"],[1,"ui-helper-clearfix",2,"text-align","left"],[1,"mr-1"],[1,"fas","fa-desktop","fa-fw"],[1,"far","fa-building","fa-fw"],[1,"fixed-width-col-40"],[1,"fixed-width-col-100"],["pSortableColumn","receiptDateCreated",1,"fixed-width-col-170"],["field","receiptDateCreated"],["pSortableColumn","bankTxnDateCreated",1,"fixed-width-col-170"],["field","bankTxnDateCreated"],[1,"fixed-width-col-210"],[1,"fixed-width-col-120"],["class","fixed-width-col-100",4,"ngIf"],[1,"fixed-width-col-40","text-center"],[1,"p-column-title"],["aria-hidden","true"],[1,"fixed-width-col-170","text-center"],[1,"fixed-width-col-120","text-right"],["class","fixed-width-col-100 text-center",4,"ngIf"],[1,"fixed-width-col-100","text-center"],["target","_blank","aria-label","\u03a3\u03cd\u03bd\u03b4\u03b5\u03c3\u03bc\u03bf\u03c2 \u03b3\u03b9\u03b1 \u0391\u03c1\u03c7\u03b5\u03af\u03bf \u0395\u03ba\u03c4\u03cd\u03c0\u03c9\u03c3\u03b7\u03c2","rel","noopener",3,"href",4,"ngIf"],["target","_blank","aria-label","\u03a3\u03cd\u03bd\u03b4\u03b5\u03c3\u03bc\u03bf\u03c2 \u03b3\u03b9\u03b1 \u0391\u03c1\u03c7\u03b5\u03af\u03bf \u0395\u03ba\u03c4\u03cd\u03c0\u03c9\u03c3\u03b7\u03c2","rel","noopener",3,"href"],["aria-hidden","true",1,"far","fa-file-pdf"],["colspan","6",1,"fixed-width-col-790"],[1,"text-right",3,"ngClass"]],template:function(e,t){1&e&&(d.YNc(0,W,1,1,"p-message",0),d.YNc(1,V,1,3,"p-message",1),d.TgZ(2,"p-panel",2),d.TgZ(3,"form",3),d.TgZ(4,"div",4),d.TgZ(5,"div",5),d.TgZ(6,"label",6),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.TgZ(9,"p-calendar",7),d.NdJ("ngModelChange",function(e){return t.hmerominiaApodiksisRange=e}),d.qZA(),d.qZA(),d.TgZ(10,"div",5),d.TgZ(11,"label",8),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.TgZ(14,"p-calendar",9),d.NdJ("ngModelChange",function(e){return t.hmerominiaSinallagisRange=e}),d.qZA(),d.qZA(),d.TgZ(15,"div",5),d.TgZ(16,"label",10),d._uU(17),d.ALo(18,"translate"),d.qZA(),d.TgZ(19,"ng-select",11),d.NdJ("ngModelChange",function(e){return t.receiptType=e})("ngModelChange",function(e){return t.onReceiptTypeChanged(e)}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(20,"div",12),d.TgZ(21,"button",13),d.NdJ("click",function(){return t.onSearch()}),d._UZ(22,"i",14),d._uU(23),d.ALo(24,"translate"),d.qZA(),d.TgZ(25,"button",15),d.NdJ("click",function(){return t.onClear()}),d._UZ(26,"i",16),d._uU(27),d.ALo(28,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(29,"p-table",17),d.NdJ("sortFunction",function(e){return t._customSort(e)}),d.YNc(30,X,9,6,"ng-template",18),d.YNc(31,ee,25,22,"ng-template",19),d.YNc(32,ie,40,42,"ng-template",20),d.YNc(33,ne,4,4,"ng-template",21),d.YNc(34,ae,9,12,"ng-template",22),d.qZA()),2&e&&(d.Q6J("ngIf",t.receiptsMessage&&""!=t.receiptsMessage),d.xp6(1),d.Q6J("ngIf",!t.isLoading&&t.bankStatusMessage&&""!=t.bankStatusMessage),d.xp6(1),d.Q6J("header",t.translation.egwebapps.egrSearchFilters)("styleClass","mb-3"),d.xp6(5),d.Oqu(d.lcZ(8,47,t.translation.epayments.receiptDateRange)),d.xp6(2),d.Akn(d.DdM(57,re)),d.Q6J("baseZIndex",9999)("firstDayOfWeek",1)("selectOtherMonths",!0)("monthNavigator",!0)("yearNavigator",!0)("yearRange",t.yearRange)("showIcon",!0)("showButtonBar",!0)("readonlyInput",!0)("ngModel",t.hmerominiaApodiksisRange),d.xp6(3),d.Oqu(d.lcZ(13,49,t.translation.epayments.transactionDateRange)),d.xp6(2),d.Akn(d.DdM(58,re)),d.Q6J("baseZIndex",9999)("firstDayOfWeek",1)("selectOtherMonths",!0)("monthNavigator",!0)("yearNavigator",!0)("yearRange",t.yearRange)("showIcon",!0)("showButtonBar",!0)("readonlyInput",!0)("ngModel",t.hmerominiaSinallagisRange),d.xp6(3),d.Oqu(d.lcZ(18,51,t.translation.egwebapps.egrPaymentMethod)),d.xp6(2),d.Q6J("items",t.tropoiPliromis)("ngModel",t.receiptType)("searchable",!1)("clearable",!1),d.xp6(4),d.hij(" ",d.lcZ(24,53,t.translation.egwebapps.egrSearchBtn)," "),d.xp6(4),d.hij(" ",d.lcZ(28,55,t.translation.egwebapps.egrClearBtn)," "),d.xp6(2),d.Q6J("value",t.orderedReceiptsFiltered)("lazy",!1)("lazyLoadOnInit",!1)("rowHover",!0)("paginator",!0)("alwaysShowPaginator",!1)("rows",10)("loading",t.isLoading)("totalRecords",null==t.orderedReceiptsFiltered?null:t.orderedReceiptsFiltered.length)("customSort",!0))},directives:[u.O5,m.s,w._Y,w.JL,w.F,K.f,w.JJ,w.On,T.w9,A.iA,x.jx,g.q,A.lQ,A.fz,u.mk],pipes:[n.X$,u.uU,u.H9],encapsulation:2,changeDetection:0}),e})();var le=s(41886);function pe(e,t){if(1&e&&d._UZ(0,"p-message",4),2&e){const e=d.oxw();d.Q6J("text",null==e.translation?null:e.translation.egwebapps.egwebappsLoginMesg)}}function de(e,t){if(1&e&&(d.TgZ(0,"p-panel",5),d._UZ(1,"div",6),d.ALo(2,"decodeHtmlString"),d.qZA()),2&e){const e=d.oxw();d.Q6J("header",null==e.translation?null:e.translation.egwebapps.information)("styleClass","tab-msg mb-3")("toggleable",!0),d.xp6(1),d.Q6J("innerHTML",d.lcZ(2,4,e.tabMsg),d.oJD)}}function ce(e,t){if(1&e&&d._UZ(0,"app-receipts",10),2&e){const e=d.oxw(2);d.Q6J("tabChanged",e.onTbChanged)}}function he(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"p-tabView",7),d.NdJ("onChange",function(t){return d.CHM(e),d.oxw().onTabChanged(t)}),d.TgZ(1,"p-tabPanel",8),d._UZ(2,"app-debits"),d.qZA(),d.TgZ(3,"p-tabPanel",8),d.YNc(4,ce,1,1,"ng-template",9),d.qZA(),d.qZA()}if(2&e){const e=d.oxw();d.Q6J("activeIndex",e.index),d.xp6(1),d.Q6J("header",null==e.translation?null:e.translation.epayments.debitsTab),d.xp6(2),d.Q6J("header",null==e.translation?null:e.translation.epayments.paymentsTab)}}const ue=[{path:"",component:(()=>{class e{constructor(e,t,s,i,n,a){this.oidcSecuritySrv=e,this.appCacheSrv=t,this.location=s,this.router=i,this.route=n,this.cdr=a,this.onDestroy=new l.xQ,this.index=0,this.onTbChanged=!1,this.selectedLang="el"}ngOnInit(){this.appCacheSrv.translation$.pipe((0,p.R)(this.onDestroy)).subscribe(e=>{e&&(this.translation=e,(0,o.RA)(this.cdr))}),this.appCacheSrv.selectedLang$.pipe((0,p.R)(this.onDestroy)).subscribe(e=>{e&&(this.selectedLang=e),AppConfOptions&&1==AppConfOptions.multilingual&&"el"!=this.selectedLang&&AppConfOptions.epayments_debits_tab_info_en&&""!=AppConfOptions.epayments_debits_tab_info_en&&this.router.url.includes("debits")?this.tabMsg=AppConfOptions.epayments_debits_tab_info_en:AppConfOptions.epayments_debits_tab_info&&""!=AppConfOptions.epayments_debits_tab_info&&"el"==this.selectedLang&&this.router.url.includes("debits")&&(this.tabMsg=AppConfOptions.epayments_debits_tab_info),AppConfOptions&&1==AppConfOptions.multilingual&&"el"!=this.selectedLang&&AppConfOptions.epayments_receipts_tab_info_en&&""!=AppConfOptions.epayments_receipts_tab_info_en&&this.router.url.includes("receipts")?this.tabMsg=AppConfOptions.epayments_receipts_tab_info_en:AppConfOptions.epayments_receipts_tab_info&&""!=AppConfOptions.epayments_receipts_tab_info&&"el"==this.selectedLang&&this.router.url.includes("receipts")&&(this.tabMsg=AppConfOptions.epayments_receipts_tab_info),(0,o.RA)(this.cdr)}),this.oidcSecuritySrv.isAuthenticated$.subscribe(e=>{this.isAuthorized=e,(0,o.RA)(this.cdr)}),this.index="receipts"===this.route.children[0].snapshot.url[0].path?1:0,(0,o.RA)(this.cdr)}ngOnDestroy(){this.onDestroy.next(null)}onTabChanged(e){0==e.index?(this.router.navigate(["./debits"],{relativeTo:this.route}),AppConfOptions&&AppConfOptions.epayments_debits_tab_info&&""!=AppConfOptions.epayments_debits_tab_info&&(this.tabMsg=AppConfOptions.epayments_debits_tab_info)):(this.router.navigate(["./receipts"],{relativeTo:this.route}),this.onTbChanged=!0,AppConfOptions&&AppConfOptions.epayments_receipts_tab_info&&""!=AppConfOptions.epayments_receipts_tab_info&&(this.tabMsg=AppConfOptions.epayments_receipts_tab_info)),(0,o.RA)(this.cdr)}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(c.J_),d.Y36(h.g),d.Y36(u.Ye),d.Y36(r.F0),d.Y36(r.gz),d.Y36(d.sBO))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-epayments-layout"]],inputs:{isAuthorized:"isAuthorized"},decls:5,vars:4,consts:[[1,"module-title"],["severity","warn",3,"text",4,"ngIf"],[3,"header","styleClass","toggleable",4,"ngIf"],[3,"activeIndex","onChange",4,"ngIf"],["severity","warn",3,"text"],[3,"header","styleClass","toggleable"],[3,"innerHTML"],[3,"activeIndex","onChange"],[3,"header"],["pTemplate","content"],[3,"tabChanged"]],template:function(e,t){1&e&&(d.TgZ(0,"h3",0),d._uU(1),d.qZA(),d.YNc(2,pe,1,1,"p-message",1),d.YNc(3,de,3,6,"p-panel",2),d.YNc(4,he,5,3,"p-tabView",3)),2&e&&(d.xp6(1),d.Oqu(null==t.translation?null:t.translation.menu.epaymentsMenuItem),d.xp6(1),d.Q6J("ngIf",!t.isAuthorized),d.xp6(1),d.Q6J("ngIf",t.tabMsg),d.xp6(1),d.Q6J("ngIf",t.isAuthorized))},directives:[u.O5,g.q,m.s,f.xf,f.x4,F,x.jx,oe],pipes:[le.o],encapsulation:2}),e})(),children:[{path:"",pathMatch:"full",redirectTo:"debits"},{path:"debits",component:F},{path:"receipts",component:oe}]}];let ge=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({imports:[[r.Bz.forChild(ue)],r.Bz]}),e})(),me=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({providers:[Z.C],imports:[[ge,a.m,i.IJ,n.aw.forChild()]]}),e})()}}]);