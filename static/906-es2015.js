"use strict";(self.webpackChunkegritos_group_eg_web_apps=self.webpackChunkegritos_group_eg_web_apps||[]).push([[906],{35906:function(t,e,i){i.r(e),i.d(e,{TautotitaOfeilisModule:function(){return Y}});var s=i(43645),n=i(29790),o=i(23292),a=i(88052),r=i(54655),l=i(68214),p=i(79765),u=i(46782),c=i(37716),d=i(87622),h=i(12622),g=i(38583),m=i(3379),f=i(24020),b=i(44748),y=i(21571),A=(()=>((A||(A={})).paymentCode="\u039a\u03c9\u03b4\u03b9\u03ba\u03cc\u03c2",A))(),C=(()=>((C||(C={})).paymentCode="Payment Code",C))(),x=i(84608),_=i(91841);let Z=(()=>{class t{constructor(t,e){this.http=t,this.toasterSrv=e,this.apiUrl=AppConfOptions.eidopoiitiria_api+"api/"}getEidopoiitiria(t){return this.http.post(this.apiUrl+"Atm/Eidopoiitiria",t)}}return t.\u0275fac=function(e){return new(e||t)(c.LFG(_.eN),c.LFG(l.MJ))},t.\u0275prov=c.Yz7({token:t,factory:t.\u0275fac}),t})();var v=i(3679);const w=["tautotitaOfeilisForm"];function S(t,e){if(1&t&&c._UZ(0,"p-message",16),2&t){const t=c.oxw(2);c.Q6J("severity",t.bankStatusMessageClass)("text",t.bankStatusMessage)("styleClass","mb-2")}}function M(t,e){if(1&t&&c._UZ(0,"p-message",17),2&t){const t=c.oxw(2);c.Q6J("styleClass","mt-2 form-msgs")("escape",!1)("text",t.formErrorsMsg)}}function k(t,e){if(1&t&&(c.TgZ(0,"p",22),c._uU(1,"\u039a\u03c9\u03b4\u03b9\u03ba\u03cc\u03c2 \u03a0\u03bb\u03b7\u03c1\u03c9\u03bc\u03ae\u03c2: "),c.TgZ(2,"span",23),c._uU(3),c.qZA(),c.qZA()),2&t){const t=c.oxw(3);c.xp6(3),c.Oqu(t.model.paymentCode)}}function O(t,e){if(1&t&&(c.TgZ(0,"p",22),c._uU(1,"\u03a3\u03c4\u03bf\u03b9\u03c7\u03b5\u03af\u03b1 \u039f\u03c6\u03b5\u03b9\u03bb\u03ae\u03c2: "),c.TgZ(2,"span",23),c._uU(3),c.qZA(),c.qZA()),2&t){const t=c.oxw(3);c.xp6(3),c.Oqu(t.model.paymentCaption)}}function J(t,e){if(1&t&&(c.TgZ(0,"p",22),c._uU(1,"\u03a3\u03c5\u03bd\u03bf\u03bb\u03b9\u03ba\u03cc \u03a0\u03bf\u03c3\u03cc \u039f\u03c6\u03b5\u03b9\u03bb\u03ae\u03c2: "),c.TgZ(2,"span",23),c._uU(3),c.ALo(4,"currency"),c.qZA(),c.qZA()),2&t){const t=c.oxw(3);c.xp6(3),c.Oqu(c.gM2(4,1,t.model.paymentAmount,"\u20ac","symbol","1.2"))}}function T(t,e){if(1&t){const t=c.EpF();c.ynx(0),c._UZ(1,"hr"),c.TgZ(2,"h5",18),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.TgZ(5,"div",19),c.TgZ(6,"div"),c.YNc(7,k,4,1,"p",20),c.YNc(8,O,4,1,"p",20),c.YNc(9,J,5,6,"p",20),c.qZA(),c.TgZ(10,"app-checkout",21),c.NdJ("onPayBtnClick",function(e){return c.CHM(t),c.oxw(2).onCreatePaymentRequest(e)}),c.qZA(),c.qZA(),c.BQk()}if(2&t){const t=c.oxw(2);c.xp6(3),c.Oqu(c.lcZ(4,9,null==t.translation?null:t.translation.egwebapps.egrResults)),c.xp6(4),c.Q6J("ngIf",t.model.paymentCode),c.xp6(1),c.Q6J("ngIf",t.model.paymentCaption),c.xp6(1),c.Q6J("ngIf",t.model.paymentAmount),c.xp6(1),c.Q6J("isPaymentFormValid",!0)("doPaymentSubscription",t.onDoPaymentSubject.asObservable())("finApiUrl",t.financeApiUrl)("buttonText",t.translation.egwebapps.egrPaymentBtnText)("cancelButtonText",t.translation.egwebapps.egrCancelBtn)}}function L(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.YNc(1,S,1,3,"p-message",2),c.TgZ(2,"form",3,4),c.TgZ(4,"div",5),c.TgZ(5,"div",6),c.TgZ(6,"label",7),c._uU(7),c.ALo(8,"translate"),c.qZA(),c.TgZ(9,"input",8),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().paymentCode=e}),c.ALo(10,"translate"),c.qZA(),c.TgZ(11,"div",9),c._uU(12),c.ALo(13,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(14,"div",10),c.TgZ(15,"button",11),c.NdJ("click",function(){return c.CHM(t),c.oxw().onSubmit()}),c._UZ(16,"span",12),c._uU(17),c.ALo(18,"translate"),c.qZA(),c.TgZ(19,"button",13),c.NdJ("click",function(){return c.CHM(t),c.oxw().onClear()}),c._UZ(20,"span",14),c._uU(21),c.ALo(22,"translate"),c.qZA(),c.qZA(),c.YNc(23,M,1,3,"p-message",15),c.qZA(),c._UZ(24,"lib-egr-loading",0),c.YNc(25,T,11,11,"ng-container",1),c.BQk()}if(2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngIf",t.bankStatusMessage&&""!=t.bankStatusMessage),c.xp6(6),c.hij("",c.lcZ(8,14,null==t.translation?null:t.translation.eidopoiitiria.code),"*"),c.xp6(2),c.Q6J("placeholder",c.lcZ(10,16,null==t.translation?null:t.translation.eidopoiitiria.code))("ngModel",t.paymentCode)("disabled",t.model),c.xp6(2),c.Q6J("hidden",!t.isFormSubmitted||t.isFormSubmitted&&t.paymentCode),c.xp6(1),c.hij(" *",c.lcZ(13,18,null==t.translation?null:t.translation.egwebapps.egrRequiredField)," "),c.xp6(3),c.Q6J("disabled",t.model),c.xp6(2),c.hij(" ",c.lcZ(18,20,null==t.translation?null:t.translation.egwebapps.egrSearchBtn)," "),c.xp6(4),c.hij(" ",c.lcZ(22,22,null==t.translation?null:t.translation.egwebapps.egrClearBtn)," "),c.xp6(2),c.Q6J("ngIf",t.formErrorsMsg&&""!=t.formErrorsMsg),c.xp6(1),c.Q6J("condition",t.isLoadingInit)("customClass","egr-load-small"),c.xp6(1),c.Q6J("ngIf",t.model&&!t.isLoading)}}let q=(()=>{class t{constructor(t,e,i,s,n,o,a,r,l){this.oidcSecuritySrv=t,this.epaymentsSrv=e,this.egPaymentSrv=i,this.tautotitaOfeilisSrv=s,this.cookieSrv=n,this.toasterSrv=o,this.appCacheSv=a,this.cdr=r,this.route=l,this.countriesList=[],this.onDoPaymentSubject=new p.xQ,this.onDestroy=new p.xQ,this.isLoading=!1,this.isLoadingInit=!1,this.errorMessageProfile=null,this.oikonomikiBankMessagesEn=x.Px,this.isFormSubmitted=!1}ngOnInit(){this.appCacheSv.translation$.pipe((0,u.R)(this.onDestroy)).subscribe(t=>{t&&(this.translation=t,(0,l.RA)(this.cdr))}),this.appCacheSv.selectedLang$.pipe((0,u.R)(this.onDestroy)).subscribe(t=>{t&&(this.selectedLang=t,this.formDictionaryEnum="el"==this.selectedLang?A:C,(0,l.RA)(this.cdr))}),this.isLoadingInit=!0,(0,l.RA)(this.cdr),"undefined"!=typeof AuthConfOptions&&AppConfOptions&&AppConfOptions.epayments_api&&(this.financeApiUrl=(0,l.Qj)(AppConfOptions.epayments_api)),this.route.queryParams.pipe((0,u.R)(this.onDestroy)).subscribe(t=>{var e;if(t){let e=t;if(e.messagecode||e.paymentStatus){let t=e.messagecode?e.messagecode:e.paymentStatus;this.bankStatusMessage="el"==this.selectedLang?this.oikonomikiBankMessages[t]:this.oikonomikiBankMessagesEn[t],this.bankStatusMessageClass="TRANSACTION_COMPLETED"==t||"APPROVED"==t?"success":"error"}}else this.toasterSrv.showError("",null===(e=this.translation)||void 0===e?void 0:e.egwebapps.egrProblemFound);(0,l.RA)(this.cdr)}),this.appCacheSv.initCountries(AuthConfOptions.stsServer+"/api/general/GetCountries"),(0,y.$R)(this.epaymentsSrv.getBankMessages(),this.oidcSecuritySrv.userData$,this.appCacheSv.countries$).subscribe(t=>{t&&(t[0]&&(this.oikonomikiBankMessages=t[0]),t[1]&&(this.user=t[1]),t[2]&&(this.countriesList=t[2],this.user&&this.user.address_country_code&&""!=this.user.address_country_code&&(this.user.address_country_num=this.countriesList.find(t=>t.Alpha2Code==this.user.address_country_code).NumericCode.toString()))),this.isLoadingInit=!1,(0,l.RA)(this.cdr)})}ngOnDestroy(){this.onDestroy.next(null)}onSubmit(){if(this.isFormSubmitted=!0,this.formErrorsMsg=null,(0,l.RA)(this.cdr),this.isFormSubmitted&&this.tautotitaOfeilisForm.valid){this.model=null,this.isLoading=!0;let t={language:"el",kodikos:this.paymentCode};(0,l.RA)(this.cdr),this.tautotitaOfeilisSrv.getEidopoiitiria(t).subscribe(t=>{t&&t.isSuccessful?this.model=t.result:(this.toasterSrv.showError("",t.errorDescription),this.errorMessage=t.errorDescription),this.isLoading=!1,(0,l.RA)(this.cdr)})}else this.formErrorsMsg=(0,l.CD)(this.tautotitaOfeilisForm,this.formDictionaryEnum,""),(0,l.RA)(this.cdr)}onCreatePaymentRequest(t){if((0,l.Ew)(this.user.email))this.toasterSrv.showWarning("","\u0395\u03af\u03bd\u03b1\u03b9 \u03b1\u03c0\u03b1\u03c1\u03b1\u03af\u03c4\u03b7\u03c4\u03bf \u03c4\u03bf email \u03c3\u03b1\u03c2 \u03c3\u03c4\u03b7 \u03c3\u03b5\u03bb\u03af\u03b4\u03b1 \u03c4\u03bf\u03c5 \u03c0\u03c1\u03bf\u03c6\u03af\u03bb \u03c3\u03b1\u03c2.");else{let e={tinRelated:this.user.tin,relatedCallbackUrl:AppConfOptions.application_url+"/tautotita-ofeilis/debits",billingAddressCity:this.user.address_city,billingAddressCountryCode:this.user.address_country_code,billingAddressZip:this.user.address_zip,billingAddress:this.user.address,userEmail:this.user.email,userPhone:this.user.phone_number,paymentMethodKey:t.key,entries:[]};"PIRBGRAA"===t.key&&(e.billingAddressCountryCode=null),e.entries.push({remittanceInfo:this.model.paymentCode,amount:this.model.paymentAmount,debtorName:this.user.family_name+" "+this.user.fathers_name+" "+this.user.mothers_name+" "+this.user.name,tin:this.user.tin,description:this.model.paymentCaption}),this.paymentRequestDto=e,this.egPaymentSrv.addPaymentRequest(this.financeApiUrl,this.paymentRequestDto).subscribe(t=>{t?(this.paymentResponseDto=t,this.onDoPaymentSubject.next(this.paymentResponseDto)):this.toasterSrv.showError("",this.translation.egwebapps.egrPaymentProblemFound)})}}onClear(){this.isFormSubmitted=!1,this.paymentCode=null,this.model=null,(0,l.RA)(this.cdr)}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(d.J_),c.Y36(o.C),c.Y36(l.te),c.Y36(Z),c.Y36(l.N_),c.Y36(l.MJ),c.Y36(h.g),c.Y36(c.sBO),c.Y36(r.gz))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-tautotita-ofeilis-debits"]],viewQuery:function(t,e){if(1&t&&c.Gf(w,5),2&t){let t;c.iGM(t=c.CRH())&&(e.tautotitaOfeilisForm=t.first)}},inputs:{isAuthorized:"isAuthorized"},decls:2,vars:3,consts:[[3,"condition","customClass"],[4,"ngIf"],[3,"severity","text","styleClass",4,"ngIf"],[1,"form"],["tautotitaOfeilisForm","ngForm"],[1,"row"],[1,"form-group","col-12"],["for","paymentCode"],["name","paymentCode","type","text","required","",1,"form-control",3,"placeholder","ngModel","disabled","ngModelChange"],[1,"validation-msg","text-danger","pt-1",3,"hidden"],[1,"d-flex","align-items-center","justify-content-center","flex-wrap"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["aria-hidden","true",1,"fas","fa-search","fa-fw"],["type","button",1,"btn","btn-warning","text-white",3,"click"],["aria-hidden","true",1,"fas","fa-times","fa-fw"],["severity","error",3,"styleClass","escape","text",4,"ngIf"],[3,"severity","text","styleClass"],["severity","error",3,"styleClass","escape","text"],[1,"mt-4","text-center"],[1,"debits-info","d-flex","flex-wrap","justify-content-between","w-100","align-items-center"],["class","mb-0",4,"ngIf"],[3,"isPaymentFormValid","doPaymentSubscription","finApiUrl","buttonText","cancelButtonText","onPayBtnClick"],[1,"mb-0"],[1,"totalPoso"]],template:function(t,e){1&t&&(c._UZ(0,"lib-egr-loading",0),c.YNc(1,L,26,24,"ng-container",1)),2&t&&(c.Q6J("condition",e.isLoadingInit)("customClass","egr-load-small"),c.xp6(1),c.Q6J("ngIf",!e.isLoadingInit))},directives:[l.IE,g.O5,v._Y,v.JL,v.F,v.Fj,v.Q7,v.JJ,v.On,m.q,l.Hl],pipes:[n.X$,g.H9],encapsulation:2,changeDetection:0}),t})();var R=i(41886);function I(t,e){if(1&t&&c._UZ(0,"p-message",3),2&t){const t=c.oxw();c.Q6J("text",null==t.translation?null:t.translation.egwebapps.egwebappsLoginMesg)}}function U(t,e){if(1&t&&(c.TgZ(0,"p-panel",4),c._UZ(1,"div",5),c.ALo(2,"decodeHtmlString"),c.qZA()),2&t){const t=c.oxw();c.Q6J("styleClass","tab-msg mb-3")("toggleable",!0),c.xp6(1),c.Q6J("innerHTML",c.lcZ(2,3,t.tabMsg),c.oJD)}}function Q(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"p-tabView",6),c.NdJ("onChange",function(e){return c.CHM(t),c.oxw().onTabChanged(e)}),c.TgZ(1,"p-tabPanel",7),c.ALo(2,"translate"),c._UZ(3,"app-tautotita-ofeilis-debits"),c.qZA(),c.qZA()}if(2&t){const t=c.oxw();c.Q6J("activeIndex",t.index),c.xp6(1),c.Q6J("header",c.lcZ(2,2,null==t.translation?null:t.translation.menu.katastimataTabTitle))}}const D=[{path:"",component:(()=>{class t{constructor(t,e,i,s,n,o){this.oidcSecuritySrv=t,this.appCacheSv=e,this.location=i,this.cdr=s,this.router=n,this.route=o,this.onDestroy=new p.xQ,this.index=0,this.isUnauthorizedAllowed=AppConfOptions.unauthorized_allowed,this.selectedLang="el"}ngOnInit(){this.appCacheSv.translation$.pipe((0,u.R)(this.onDestroy)).subscribe(t=>{t&&(this.translation=t,(0,l.RA)(this.cdr))}),this.appCacheSv.selectedLang$.pipe((0,u.R)(this.onDestroy)).subscribe(t=>{t&&(this.selectedLang=t),1==AppConfOptions.multilingual&&"el"!=this.selectedLang&&AppConfOptions.eidopoiitiria_tab_info_en&&""!=AppConfOptions.eidopoiitiria_tab_info_en?this.tabMsg=AppConfOptions.eidopoiitiria_tab_info_en:AppConfOptions.eidopoiitiria_tab_info&&""!=AppConfOptions.eidopoiitiria_tab_info&&"el"==this.selectedLang&&(this.tabMsg=AppConfOptions.eidopoiitiria_tab_info),(0,l.RA)(this.cdr)}),this.oidcSecuritySrv.isAuthenticated$.subscribe(t=>{this.isAuthorized=t,(0,l.RA)(this.cdr)}),this.index="receipts"===this.route.children[0].snapshot.url[0].path?1:0,(0,l.RA)(this.cdr)}ngOnDestroy(){this.onDestroy.next(null)}onTabChanged(t){this.router.navigate(0==t.index?["./debits"]:["./receipts"],{relativeTo:this.route})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(d.J_),c.Y36(h.g),c.Y36(g.Ye),c.Y36(c.sBO),c.Y36(r.F0),c.Y36(r.gz))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-tautotita-ofeilis-layout"]],inputs:{isAuthorized:"isAuthorized"},decls:3,vars:3,consts:[["severity","warn",3,"text",4,"ngIf"],["header","\u03a0\u03bb\u03b7\u03c1\u03bf\u03c6\u03bf\u03c1\u03af\u03b5\u03c2",3,"styleClass","toggleable",4,"ngIf"],[3,"activeIndex","onChange",4,"ngIf"],["severity","warn",3,"text"],["header","\u03a0\u03bb\u03b7\u03c1\u03bf\u03c6\u03bf\u03c1\u03af\u03b5\u03c2",3,"styleClass","toggleable"],[3,"innerHTML"],[3,"activeIndex","onChange"],[3,"header"]],template:function(t,e){1&t&&(c.YNc(0,I,1,1,"p-message",0),c.YNc(1,U,3,5,"p-panel",1),c.YNc(2,Q,4,4,"p-tabView",2)),2&t&&(c.Q6J("ngIf",!e.isAuthorized&&!e.isUnauthorizedAllowed),c.xp6(1),c.Q6J("ngIf",e.isAuthorized&&e.tabMsg&&""!=e.tabMsg),c.xp6(1),c.Q6J("ngIf",e.isAuthorized||e.isUnauthorizedAllowed))},directives:[g.O5,m.q,f.s,b.xf,b.x4,q],pipes:[R.o,n.X$],encapsulation:2,changeDetection:0}),t})(),children:[{path:"",pathMatch:"full",redirectTo:"debits"},{path:"debits",component:q}]}];let P=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[r.Bz.forChild(D)],r.Bz]}),t})(),Y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({providers:[Z,o.C],imports:[[a.m,s.IJ,P,n.aw.forChild()]]}),t})()}}]);