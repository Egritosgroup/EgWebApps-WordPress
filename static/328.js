"use strict";(self.webpackChunkegritos_group_eg_web_apps=self.webpackChunkegritos_group_eg_web_apps||[]).push([[328],{3947:(Oe,E,p)=>{p.r(E),p.d(E,{EpaymentsModule:()=>Ie});var B=p(4864),_=p(6230),M=p(5265),f=p(7921),a=p(3228),y=p(5657),h=p(3616),C=p(7368),e=p(4496),b=p(2116),w=p(9161),u=p(1368),k=p(7564),I=p(1123),D=p(6328),O=p(1148),F=p(1528),S=p(8080),R=p(9748),N=p(9016),m=p(6504),G=p(120),g=p(8552),Y=p(312);function $(n,l){if(1&n&&e.wR5(0,"p-message",4),2&n){const t=e.GaO();e.E7m("text",t.bankStatusMessage)("styleClass","mt-2")}}function V(n,l){if(1&n&&e.wR5(0,"p-message",4),2&n){const t=e.GaO(2);e.E7m("text",t.translation.epayments.noCheckedDebits)("styleClass","my-2")}}function L(n,l){1&n&&e.wR5(0,"p-message",6),2&n&&e.E7m("styleClass","my-2")}function X(n,l){1&n&&e.C_f(0)}function U(n,l){if(1&n&&(e.I0R(0,"div",15),e.yuY(1,X,1,0,"ng-container",16),e.C$Y()),2&n){e.GaO(3);const t=e.Gew(4);e.yG2(),e.E7m("ngTemplateOutlet",t)}}function K(n,l){if(1&n){const t=e.KQA();e.I0R(0,"form",17)(1,"label"),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"ng-select",18),e.iHE("ngModelChange",function(i){e.usT(t);const r=e.GaO(3);return e.kNx(r.selectedEidosId,i)||(r.selectedEidosId=i),e.CGJ(i)}),e.qCj("ngModelChange",function(i){e.usT(t);const r=e.GaO(3);return e.CGJ(r.onSelectedPersistedTypeChanged(i))}),e.C$Y()()}if(2&n){const t=e.GaO(3);e.yG2(2),e.cNF(e.kDX(3,5,t.translation.epayments.debitType)),e.yG2(2),e.E7m("appendTo","body")("clearable",!1)("items",t.eidosDebit),e.OKB("ngModel",t.selectedEidosId)}}function z(n,l){if(1&n&&(e.I0R(0,"div",19)(1,"span",20),e.wR5(2,"i",21),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"span",20),e.wR5(6,"i",22),e.OEk(7),e.wVc(8,"translate"),e.C$Y()()),2&n){const t=e.GaO(3);e.yG2(3),e.oRS(" ",e.kDX(4,2,t.translation.epayments.persistedDebit),""),e.yG2(4),e.oRS(" ",e.kDX(8,4,t.translation.epayments.nonPersistedDebit),"")}}function j(n,l){if(1&n&&(e.I0R(0,"th",26),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&n){const t=e.GaO(4);e.yG2(),e.cNF(e.kDX(2,1,t.translation.egwebapps.debitType))}}function H(n,l){if(1&n){const t=e.KQA();e.I0R(0,"tr")(1,"th",23)(2,"p-checkbox",24),e.iHE("ngModelChange",function(i){e.usT(t);const r=e.GaO(3);return e.kNx(r.isAllDebitsChecked,i)||(r.isAllDebitsChecked=i),e.CGJ(i)}),e.qCj("onChange",function(){e.usT(t);const i=e.GaO(3);return e.CGJ(i.onAllDebitsSelected())}),e.C$Y()(),e.yuY(3,j,3,3,"th",25),e.I0R(4,"th",26),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"th",27),e.OEk(8),e.wVc(9,"translate"),e.C$Y(),e.I0R(10,"th",28),e.OEk(11),e.wVc(12,"translate"),e.C$Y(),e.I0R(13,"th",29),e.OEk(14),e.wVc(15,"translate"),e.wR5(16,"p-sortIcon",30),e.C$Y(),e.I0R(17,"th",31),e.OEk(18),e.wVc(19,"translate"),e.wR5(20,"p-sortIcon",32),e.C$Y(),e.I0R(21,"th",33),e.OEk(22),e.wVc(23,"translate"),e.wR5(24,"p-sortIcon",34),e.C$Y(),e.I0R(25,"th",35),e.OEk(26),e.wVc(27,"translate"),e.wR5(28,"p-sortIcon",36),e.C$Y()()}if(2&n){const t=e.GaO(3);e.yG2(2),e.E7m("binary",!0),e.OKB("ngModel",t.isAllDebitsChecked),e.yG2(),e.E7m("ngIf",t.isNonPersistedEnabled),e.yG2(2),e.cNF(e.kDX(6,10,t.translation.egwebapps.egrAA)),e.yG2(3),e.cNF(e.kDX(9,12,t.translation.egwebapps.egrXK)),e.yG2(3),e.cNF(e.kDX(12,14,t.translation.egwebapps.description)),e.yG2(3),e.oRS("",e.kDX(15,16,t.translation.egwebapps.egrExpDate)," "),e.yG2(4),e.oRS("",e.kDX(19,18,t.translation.epayments.netPoso)," "),e.yG2(4),e.oRS("",e.kDX(23,20,t.translation.egwebapps.egrOngoingCharges),"* "),e.yG2(4),e.oRS("",e.kDX(27,22,t.translation.egwebapps.egrTotalCost)," ")}}function J(n,l){if(1&n&&(e.I0R(0,"td",23)(1,"span",37),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.wR5(4,"i",41),e.C$Y()),2&n){const t=e.GaO().$implicit,s=e.GaO(3);e.yG2(2),e.cNF(e.kDX(3,2,s.translation.egwebapps.debitType)),e.yG2(2),e.E7m("ngClass",t.isBebaiomeno?"far fa-dot-circle text-success":"fas fa-dot-circle text-warning")}}function Q(n,l){if(1&n&&(e.I0R(0,"span"),e.OEk(1),e.wVc(2,"date"),e.C$Y()),2&n){const t=e.GaO().$implicit;e.yG2(),e.cNF(e.g7$(2,1,t.hmerominiaLixis,"dd/LL/yyyy"))}}function W(n,l){if(1&n){const t=e.KQA();e.I0R(0,"tr")(1,"td",23)(2,"span",37),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"p-checkbox",24),e.iHE("ngModelChange",function(i){const o=e.usT(t).$implicit;return e.kNx(o.isChecked,i)||(o.isChecked=i),e.CGJ(i)}),e.qCj("onChange",function(){e.usT(t);const i=e.GaO(3);return e.CGJ(i._calculateTotalAmounts())}),e.C$Y()(),e.yuY(6,J,5,4,"td",38),e.I0R(7,"td",26)(8,"span",37),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.OEk(11),e.C$Y(),e.I0R(12,"td",27)(13,"span",37),e.OEk(14),e.wVc(15,"translate"),e.C$Y(),e.OEk(16),e.C$Y(),e.I0R(17,"td",28)(18,"span",37),e.OEk(19),e.wVc(20,"translate"),e.C$Y(),e.OEk(21),e.C$Y(),e.I0R(22,"td",39)(23,"span",37),e.OEk(24),e.wVc(25,"translate"),e.C$Y(),e.yuY(26,Q,3,4,"span",2),e.C$Y(),e.I0R(27,"td",40)(28,"span",37),e.OEk(29),e.wVc(30,"translate"),e.C$Y(),e.OEk(31),e.wVc(32,"currency"),e.C$Y(),e.I0R(33,"td",40)(34,"span",37),e.OEk(35),e.wVc(36,"translate"),e.C$Y(),e.OEk(37),e.wVc(38,"currency"),e.C$Y(),e.I0R(39,"td",40)(40,"span",37),e.OEk(41),e.wVc(42,"translate"),e.C$Y(),e.OEk(43),e.wVc(44,"currency"),e.C$Y()()}if(2&n){const t=l.$implicit,s=l.rowIndex,i=e.GaO(3);e.yG2(3),e.cNF(e.kDX(4,18,i.translation.egwebapps.egrSelect)),e.yG2(2),e.E7m("binary",!0),e.OKB("ngModel",t.isChecked),e.yG2(),e.E7m("ngIf",i.isNonPersistedEnabled),e.yG2(3),e.cNF(e.kDX(10,20,i.translation.egwebapps.egrAA)),e.yG2(2),e.oRS(" ",s+1," "),e.yG2(3),e.cNF(e.kDX(15,22,i.translation.egwebapps.egrXK)),e.yG2(2),e.oRS(" ",t.aaEggrafis," "),e.yG2(3),e.cNF(e.kDX(20,24,i.translation.egwebapps.description)),e.yG2(2),e.oRS(" ",t.perigrafi," "),e.yG2(3),e.cNF(e.kDX(25,26,i.translation.egwebapps.egrExpDate)),e.yG2(2),e.E7m("ngIf",t.isBebaiomeno),e.yG2(3),e.cNF(e.kDX(30,28,i.translation.epayments.netPoso)),e.yG2(2),e.oRS(" ",e.wB1(32,30,t.currentKatharoPoso,"\u20ac","symbol","1.2")," "),e.yG2(4),e.cNF(e.kDX(36,35,i.translation.egwebapps.egrOngoingCharges)),e.yG2(2),e.oRS(" ",e.wB1(38,37,t.currentProsafksisi+t.currentKrathseis,"\u20ac","symbol","1.2")," "),e.yG2(4),e.cNF(e.kDX(42,42,i.translation.egwebapps.egrTotalCost)),e.yG2(2),e.oRS(" ",e.wB1(44,44,t.currentSynolo,"\u20ac","symbol","1.2")," ")}}function Z(n,l){if(1&n&&(e.I0R(0,"tr")(1,"td"),e.OEk(2," \u0394\u03b5\u03bd \u03b2\u03c1\u03ad\u03b8\u03b7\u03ba\u03b1\u03bd \u03b5\u03b3\u03b3\u03c1\u03b1\u03c6\u03ad\u03c2. "),e.C$Y()()),2&n){const t=e.GaO(3);e.yG2(),e.e48("colspan",t.isNonPersistedEnabled?9:8)}}function q(n,l){if(1&n&&(e.I0R(0,"td",45)(1,"strong"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&n){const t=e.GaO(4);e.yG2(2),e.CAO("",e.kDX(3,2,t.translation.egwebapps.egrTotal),": ",null==t.filteredDebits.entries?null:t.filteredDebits.entries.length,"")}}function ee(n,l){if(1&n&&(e.I0R(0,"td",46)(1,"strong"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&n){const t=e.GaO(4);e.yG2(2),e.CAO("",e.kDX(3,2,t.translation.egwebapps.egrTotal),": ",null==t.filteredDebits.entries?null:t.filteredDebits.entries.length,"")}}function te(n,l){if(1&n&&(e.I0R(0,"tr"),e.yuY(1,q,4,4,"td",42)(2,ee,4,4,"td",43),e.I0R(3,"td",44)(4,"strong"),e.OEk(5),e.wVc(6,"currency"),e.C$Y()(),e.I0R(7,"td",44)(8,"strong"),e.OEk(9),e.wVc(10,"currency"),e.C$Y()(),e.I0R(11,"td",44)(12,"strong"),e.OEk(13),e.wVc(14,"currency"),e.C$Y()()()),2&n){const t=e.GaO(3);e.yG2(),e.E7m("ngIf",!t.isNonPersistedEnabled),e.yG2(),e.E7m("ngIf",t.isNonPersistedEnabled),e.yG2(3),e.cNF(e.wB1(6,5,t.totalCurrentKatharo,"\u20ac","symbol","1.2")),e.yG2(4),e.cNF(e.wB1(10,10,t.totalCurrentProsafksisi,"\u20ac","symbol","1.2")),e.yG2(4),e.cNF(e.wB1(14,15,t.totalcurrentSynolo,"\u20ac","symbol","1.2"))}}function se(n,l){if(1&n){const t=e.KQA();e.SAx(0),e.yuY(1,U,2,1,"div",7)(2,K,5,7,"form",8),e.I0R(3,"p-table",9),e.qCj("sortFunction",function(i){e.usT(t);const r=e.GaO(2);return e.CGJ(r._customSort(i))}),e.yuY(4,z,9,6,"ng-template",10)(5,H,29,24,"ng-template",11)(6,W,45,49,"ng-template",12)(7,Z,3,1,"ng-template",13)(8,te,15,20,"ng-template",14),e.C$Y(),e.I0R(9,"p")(10,"small")(11,"em"),e.OEk(12),e.wVc(13,"translate"),e.C$Y()()(),e.k70()}if(2&n){const t=e.GaO(2);e.yG2(),e.E7m("ngIf",t.calculatedChecked.countChecked>0),e.yG2(),e.E7m("ngIf",t.isNonPersistedEnabled),e.yG2(),e.E7m("value",t.filteredDebits.entries)("lazy",!1)("lazyLoadOnInit",!1)("rowHover",!0)("paginator",!0)("alwaysShowPaginator",!1)("rows",10)("loading",t.isLoading)("totalRecords",null==t.filteredDebits.entries?null:t.filteredDebits.entries.length)("customSort",!0),e.yG2(9),e.oRS("* ",e.kDX(13,13,t.translation.egwebapps.egrOngoingChargesAndDeductions),"")}}function ie(n,l){if(1&n&&(e.I0R(0,"div"),e.yuY(1,V,1,2,"p-message",1)(2,L,1,1,"p-message",5)(3,se,14,15,"ng-container",2),e.C$Y()),2&n){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.filteredDebits.entries&&t.filteredDebits.entries.length&&0===t.calculatedChecked.countChecked&&t.debits.entries),e.yG2(),e.E7m("ngIf",t.filteredDebits.entries&&0===t.filteredDebits.entries.length),e.yG2(),e.E7m("ngIf",t.filteredDebits.entries)}}function ne(n,l){if(1&n){const t=e.KQA();e.I0R(0,"div",47)(1,"div")(2,"p",48),e.OEk(3),e.wVc(4,"translate"),e.I0R(5,"span",49),e.OEk(6),e.wVc(7,"translate"),e.wVc(8,"translate"),e.C$Y()(),e.I0R(9,"p",48),e.OEk(10),e.wVc(11,"translate"),e.I0R(12,"span",49),e.OEk(13),e.wVc(14,"currency"),e.C$Y()(),e.I0R(15,"p",48),e.OEk(16),e.wVc(17,"translate"),e.I0R(18,"span",49),e.OEk(19),e.wVc(20,"currency"),e.C$Y()(),e.I0R(21,"p",48),e.OEk(22),e.wVc(23,"translate"),e.I0R(24,"span",50),e.OEk(25),e.wVc(26,"currency"),e.C$Y()()(),e.I0R(27,"eg-checkout",51),e.qCj("payBtnClick",function(i){e.usT(t);const r=e.GaO();return e.CGJ(r.onCreatePaymentRequest(i))}),e.C$Y()()}if(2&n){const t=e.GaO();e.yG2(3),e.oRS("",e.kDX(4,17,t.translation.egwebapps.egrSelected)," "),e.yG2(3),e.CAO("",t.calculatedChecked.countChecked," ",1===t.calculatedChecked.countChecked?e.kDX(7,19,t.translation.epayments.debit):e.kDX(8,21,t.translation.epayments.debits),""),e.yG2(4),e.oRS("",e.kDX(11,23,t.translation.epayments.netPoso),": "),e.yG2(3),e.cNF(e.wB1(14,25,t.calculatedChecked.checkedKatharo,"\u20ac","symbol","1.2")),e.yG2(3),e.oRS("",e.kDX(17,30,t.translation.egwebapps.egrOngoingCharges),": "),e.yG2(3),e.cNF(e.wB1(20,32,t.calculatedChecked.checkedEpivarinseis,"\u20ac","symbol","1.2")),e.yG2(3),e.oRS("",e.kDX(23,37,t.translation.epayments.totalChecked),": "),e.yG2(3),e.cNF(e.wB1(26,39,t.calculatedChecked.checkedSum,"\u20ac","symbol","1.2")),e.yG2(2),e.E7m("isPaymentFormValid",!0)("ariaDisabled",t.isDisabledPaymentMethod)("onlinePaymentSettings",t.onlinePaymentSettings)("doPaymentSubscription",t.onDoPaymentSubject.asObservable())("ismastercardNbgPaymentMethod",t.ismastercardNbgPaymentMethod)("govPaymentGatewayApiUrl",t.govPaymentGatewayApiUrl)("buttonText",t.translation.egwebapps.egrPaymentBtnText)("cancelButtonText",t.translation.egwebapps.egrCancelBtn)}}let T=(()=>{class n{constructor(t,s,i,r,o,c,d){this.toasterSrv=t,this.oidcSecuritySrv=s,this.epaymentsSrv=i,this.egPaymentSrv=r,this.appCacheSv=o,this.cdr=c,this._parent=d,this.countriesList=[],this.onDoPaymentSubject=new y.E,this.isDisabledPaymentMethod=!1,this.ismastercardNbgPaymentMethod=!1,this.isMobile=!1,this.bankStatusMessage=null,this.calculatedChecked={countChecked:0,countText:"\u03bf\u03c6\u03b5\u03b9\u03bb\u03ad\u03c2",checkedSum:0,checkedKatharo:0,checkedProsafksisis:0},this.isAllDebitsChecked=!1,this.isLoading=!0,this.eidosDebit=[],this.selectedEidosId=0,this.onDestroy=new y.E,this.oikonomikiBankMessagesEn=S.o9}ngOnInit(){if(this.appCacheSv.translation$.pipe((0,h.a)(this.onDestroy)).subscribe(s=>{s&&(this.translation=s),(0,a.Er)(this.cdr)}),this.appCacheSv.selectedLang$.pipe((0,h.a)(this.onDestroy)).subscribe(s=>{s&&(this.eidosDebit="en"===(this.selectedLang=s,s)?[{value:0,perigrafi:"All"},{value:1,perigrafi:"Persisted Debits"},{value:2,perigrafi:"Non Persisted Debits"}]:[{value:0,perigrafi:"\u038c\u03bb\u03b5\u03c2"},{value:1,perigrafi:"\u0392\u03b5\u03b2\u03b1\u03b9\u03c9\u03bc\u03ad\u03bd\u03b5\u03c2 \u039f\u03c6\u03b5\u03b9\u03bb\u03ad\u03c2"},{value:2,perigrafi:"\u039c\u03b7 \u0392\u03b5\u03b2\u03b1\u03b9\u03c9\u03bc\u03ad\u03bd\u03b5\u03c2 \u039f\u03c6\u03b5\u03b9\u03bb\u03ad\u03c2"}])}),this.isMobile=this._parent.isMobile,this.isNonPersistedEnabled=AppConfOptions.show_non_persisted_debits,typeof AuthConfOptions<"u"&&AppConfOptions){let s;AppConfOptions.finance_api?s=(0,a.sF)(AppConfOptions.finance_api):AppConfOptions.epayments_api&&(s=(0,a.sF)(AppConfOptions.epayments_api)),this.govPaymentGatewayApiUrl=(0,a.w1)(AppConfOptions.gov_payment_gateway_api)?s:(0,a.sF)(AppConfOptions.gov_payment_gateway_api)}let t=`${(0,a.sF)(AuthConfOptions.stsServer)}/api/general/GetCountries`;this.appCacheSv.initCountries(t),this.appCacheSv.countries$.pipe((0,h.a)(this.onDestroy)).subscribe(s=>this.countriesList=s),this.oidcSecuritySrv.getUserData().pipe((0,h.a)(this.onDestroy)).subscribe(s=>{s&&(this.user=s)}),(0,a.w1)(this.govPaymentGatewayApiUrl)||this.onlinePaymentSettings?(this.toasterSrv.showError("","\u0397 \u03b5\u03c6\u03b1\u03c1\u03bc\u03bf\u03b3\u03ae \u03b4\u03b5\u03bd \u03b5\u03af\u03bd\u03b1\u03b9 \u03c3\u03c9\u03c3\u03c4\u03ac \u03c0\u03b1\u03c1\u03b1\u03bc\u03b5\u03c4\u03c1\u03bf\u03c0\u03bf\u03b9\u03b7\u03bc\u03ad\u03bd\u03b7."),this.isDisabledPaymentMethod=!0,(0,a.Er)(this.cdr)):this._getPaymentSettings(),window.errorCallback=function(){alert("error clicked")},window.cancelCallback=function(){alert("cancel clicked")},window.errorCallback=this.errorCallback.bind(this),window.cancelCallback=this.cancelCallback.bind(this),this._initDebitsByTin()}ngOnDestroy(){delete window.errorCallback,delete window.cancelCallback,this.onDestroy.next(null),this.onDestroy.complete()}onCreatePaymentRequest(t){if((0,a.w1)(this.user.email))this.toasterSrv.showWarning("","\u0395\u03af\u03bd\u03b1\u03b9 \u03b1\u03c0\u03b1\u03c1\u03b1\u03af\u03c4\u03b7\u03c4\u03bf \u03c4\u03bf email \u03c3\u03b1\u03c2 \u03c3\u03c4\u03b7 \u03c3\u03b5\u03bb\u03af\u03b4\u03b1 \u03c4\u03bf\u03c5 \u03c0\u03c1\u03bf\u03c6\u03af\u03bb \u03c3\u03b1\u03c2.");else{this.paymentRequestDto=void 0,(0,a.Er)(this.cdr);let s=this.filteredDebits.entries.filter(i=>i.isChecked);if(s&&s.length){let i={tinRelated:this.user.tin,relatedCallbackUrl:AppConfOptions.application_url+"/epayments/receipts",billingAddressCity:this.user.address_city,billingAddressCountryCode:this.user.address_country_code,billingAddressZip:this.user.address_zip,billingAddress:this.user.address,userEmail:this.user.email,userPhone:this.user.phone_number,paymentMethodKey:t.key,entries:[]};"PIRBGRAA"===t.key&&(i.billingAddressCountryCode=null);for(let r of s.filter(o=>o.isChecked)){let o={remittanceInfo:this._createRemittanceInfo(r),amount:r.currentSynolo,debtorName:r.eponymia,tin:this.user.tin,description:r.perigrafi,metadata:r.metadata};i.entries.push(o)}this.paymentRequestDto=i,(0,a.Er)(this.cdr),this.egPaymentSrv.addPaymentRequest(this.govPaymentGatewayApiUrl,this.paymentRequestDto).subscribe(r=>{r?(this.paymentResponseDto=r,this.onDoPaymentSubject.next(this.paymentResponseDto)):this.toasterSrv.showError("",this.translation.egwebapps.egrPaymentProblemFound)})}}}onAllDebitsSelected(){this.filteredDebits.entries.forEach(t=>{t.isChecked=this.isAllDebitsChecked}),(0,a.Er)(this.cdr),this._calculateTotalAmounts()}onSelectedPersistedTypeChanged(t){this.selectedEidosId=+t,this.filteredDebits=(0,a.O0)(this.debits),this.filteredDebits.entries=1===this.selectedEidosId?this.debits.entries.filter(s=>!0===s.isBebaiomeno):2===this.selectedEidosId?this.debits.entries.filter(s=>!1===s.isBebaiomeno):this.debits.entries,(0,a.Er)(this.cdr),this._fillDebitsTable(this.filteredDebits)}_initDebitsByTin(){if(this.isLoading=!0,(0,a.Er)(this.cdr),this.user){this.countriesList&&this.user.address_country_code&&""!=this.user.address_country_code&&(this.user.address_country_num=this.countriesList.find(s=>s.Alpha2Code==this.user.address_country_code).NumericCode.toString()),this.user.email=(0,a.w1)(this.user.email)?this.user.email:this.user.email.trim(),this.user.username=(0,a.w1)(this.user.username)?this.user.username:this.user.username.trim(),this.user.tin=(0,a.w1)(this.user.tin)?this.user.tin:this.user.tin.trim(),this.user.family_name=(0,a.w1)(this.user.family_name)?this.user.family_name:this.user.family_name.trim(),this.user.given_name=(0,a.w1)(this.user.given_name)?this.user.given_name:this.user.given_name.trim(),this.user.fathers_name=(0,a.w1)(this.user.fathers_name)?this.user.fathers_name:this.user.fathers_name.trim(),this.user.mothers_name=(0,a.w1)(this.user.mothers_name)?this.user.mothers_name:this.user.mothers_name.trim(),this.user.name=(0,a.w1)(this.user.name)?this.user.name:this.user.name.trim(),this.user.address_city=(0,a.w1)(this.user.address_city)?this.user.address_city:this.user.address_city.trim(),this.user.address_country_code=(0,a.w1)(this.user.address_country_code)?this.user.address_country_code:this.user.address_country_code.trim(),this.user.address_country_num=(0,a.w1)(this.user.address_country_num)?this.user.address_country_num:this.user.address_country_num.trim(),this.user.address_zip=(0,a.w1)(this.user.address_zip)?this.user.address_zip:this.user.address_zip.trim(),this.user.address=(0,a.w1)(this.user.address)?this.user.address:this.user.address.trim(),this.user.adt=(0,a.w1)(this.user.adt)?this.user.adt:this.user.adt.trim(),this.user.phone_number=(0,a.w1)(this.user.phone_number)?this.user.phone_number:this.user.phone_number.trim();let t={tin:this.user.tin};this.egPaymentSrv.getBankMessages(this.govPaymentGatewayApiUrl).pipe((0,C.G)(s=>(this.oikonomikiBankMessages=s,this.epaymentsSrv.getDebitsByTin(t)))).subscribe(s=>{s&&(s.entries&&s.entries.length>=0?(this.debits=s,this._fillDebitsTable(this.debits)):(s.message||s.messageId)&&(this.bankStatusMessage="el"==this.selectedLang?this.oikonomikiBankMessages[s.messageId]?this.oikonomikiBankMessages[s.messageId]:s.message:this.oikonomikiBankMessagesEn[s.messageId]?this.oikonomikiBankMessagesEn[s.messageId]:s.message,this.toasterSrv.showError("",this.bankStatusMessage)),this.isLoading=!1)})}else this.toasterSrv.showError("","\u03a5\u03c0\u03ae\u03c1\u03be\u03b5 \u03ba\u03ac\u03c0\u03bf\u03b9\u03bf \u03c0\u03c1\u03cc\u03b2\u03bb\u03b7\u03bc\u03b1 \u03bc\u03b5 \u03c4\u03b7\u03bd \u03b1\u03bd\u03ac\u03ba\u03c4\u03b7\u03c3\u03b7 \u03c4\u03c9\u03bd \u03c3\u03c4\u03bf\u03b9\u03c7\u03b5\u03af\u03c9\u03bd \u03c7\u03c1\u03ae\u03c3\u03c4\u03b7.")}_fillDebitsTable(t){if(this.isLoading=!0,(0,a.Er)(this.cdr),t.statusCode==a.oZ.Error)return this.toasterSrv.showWarning("",this.translation.epayments.duplicateTin),void(this.bankStatusMessage=this.translation.epayments.duplicateTin);if(t.statusCode==a.oZ.UndefinedError)return this.toasterSrv.showWarning("",this.translation.epayments.loadPaymentsError),void(this.bankStatusMessage=this.translation.epayments.loadPaymentsError);0===t.entries.length&&(this.bankStatusMessage=this.translation.epayments.noDebitsFound),!1===this.isNonPersistedEnabled&&(t.entries=t.entries.filter(c=>!0===c.isBebaiomeno)),t.entries.forEach(c=>{c.isChecked=!1});let s=t.entries.map(c=>c.currentKatharoPoso);this.totalCurrentKatharo=s.reduce((c,d)=>c+d,0);let i=t.entries.map(c=>c.currentProsafksisi),r=t.entries.map(c=>c.currentKrathseis);this.totalCurrentProsafksisi=i.reduce((c,d)=>c+d,0)+r.reduce((c,d)=>c+d,0);let o=t.entries.map(c=>c.currentSynolo);this.totalcurrentSynolo=o.reduce((c,d)=>c+d,0),t.entries.sort(function(c,d){return Date.parse(c.hmerominiaLixis)/1e3-Date.parse(d.hmerominiaLixis)/1e3}),this.filteredDebits=t,this.isLoading=!1,(0,a.Er)(this.cdr)}_calculateTotalAmounts(){let t=0,s=0,i=0,r=0,o=this.translation.epayments.debits;this.filteredDebits.entries.forEach(c=>{c.isChecked&&(r++,t+=c.currentSynolo,s+=c.currentKatharoPoso,i+=c.currentProsafksisi+c.currentKrathseis)}),o=1==r?this.translation.epayments.debit:this.translation.epayments.debits,this.calculatedChecked={countChecked:r,countText:o,checkedSum:t,checkedKatharo:s,checkedEpivarinseis:i}}_createRemittanceInfo(t){return t.remittanceInfo}_customSort(t){t.hasOwnProperty("field")&&(this.filteredDebits.entries="hmerominiaLixis"===t.field?t.hasOwnProperty("order")&&1==t.order?this.filteredDebits.entries.sort(function(s,i){return+new Date(i.hmerominiaLixis)-+new Date(s.hmerominiaLixis)>0?1:-1}):this.filteredDebits.entries.sort(function(s,i){return+new Date(i.hmerominiaLixis)-+new Date(s.hmerominiaLixis)<0?1:-1}):t.hasOwnProperty("order")&&1==t.order?this.filteredDebits.entries.sort(function(s,i){return+i[t.field]-+s[t.field]>0?1:-1}):this.filteredDebits.entries.sort(function(s,i){return+i[t.field]-+s[t.field]<0?1:-1}))}errorCallback(t){const s=sessionStorage.getItem("lastTransactionId");if(sessionStorage.removeItem("lastTransactionId"),s){const r=`Error: ${t?.message||JSON.stringify(t)||"Unknown error"}`,o=encodeURIComponent(r);window.location.href=`${this.govPaymentGatewayApiUrl}/api/Banks/NationalBankmastercardGatewayCallback?transactionId=${s}&resultIndicator=${o}`}}cancelCallback(){const t=sessionStorage.getItem("lastTransactionId");sessionStorage.removeItem("lastTransactionId"),t&&(location.href=`${this.govPaymentGatewayApiUrl}/api/Banks/NationalBankmastercardGatewayCallback?transactionId=${t}&resultIndicator=UserCanceled`)}_getPaymentSettings(){this.isLoading=!0,(0,a.Er)(this.cdr),this.egPaymentSrv.getPaymentSetting(this.govPaymentGatewayApiUrl).subscribe(t=>{t?(this.onlinePaymentSettings=t,this.onlinePaymentSettings.paymentMethods=t.paymentMethods?.filter(s=>s.emfanisiStoEgwebapps??!0)||[],this.addJsScriptInDom()):(this.isDisabledPaymentMethod=!0,this.toasterSrv.showError("","\u0391\u03b4\u03c5\u03bd\u03b1\u03bc\u03af\u03b1 \u03bb\u03ae\u03c8\u03b7\u03c2 \u03c4\u03c1\u03cc\u03c0\u03c9\u03bd \u03c0\u03bb\u03b7\u03c1\u03c9\u03bc\u03ae\u03c2.")),this.isLoading=!1,(0,a.Er)(this.cdr)})}addJsScriptInDom(){var t=this;return(0,F.c)(function*(){var s=t.onlinePaymentSettings.paymentMethods.find(r=>"ETHNGRAA"===r.key);t.ismastercardNbgPaymentMethod=null!=s&&null!=s.parameters&&"https://ibanke-commerce.nbg.gr/static/checkout/checkout.min.js"===s.parameters.javaScriptSource;const i=[];!document.getElementById("script_1_ethnikiMaster")&&t.ismastercardNbgPaymentMethod&&i.push(t._loadEthnikiMaterScripts(s)),yield Promise.all(i),t.ismastercardNbgPaymentMethod&&t.onDoPaymentSubject.asObservable().pipe((0,h.a)(t.onDestroy)).subscribe(r=>{r?.postFields?.["session.id"]&&(sessionStorage.setItem("lastTransactionId",r.transactionId),Checkout.configure({session:{id:r.postFields["session.id"]}}),Checkout.showPaymentPage())})})()}_loadEthnikiMaterScripts(t){return new Promise((s,i)=>{const r=document.createElement("script");r.id="script_1_ethnikiMaster",r.src=t.parameters.javaScriptSource,r.setAttribute("data-error","errorCallback"),r.setAttribute("data-cancel","cancelCallback"),r.onload=()=>s(),document.body.appendChild(r)})}static{this.\u0275fac=function(s){return new(s||n)(e.GI1(a.y6),e.GI1(b.Bf),e.GI1(R.A),e.GI1(a.U5),e.GI1(w.i),e.GI1(e.kD9),e.GI1(N.a))}}static{this.\u0275cmp=e.In1({type:n,selectors:[["app-debits"]],inputs:{isAuthorized:"isAuthorized"},decls:5,vars:4,consts:[[3,"condition","customClass"],["severity","warn",3,"text","styleClass",4,"ngIf"],[4,"ngIf"],["selectedDebits",""],["severity","warn",3,"text","styleClass"],["severity","warn","text","\u0394\u03b5\u03bd \u03b2\u03c1\u03ad\u03b8\u03b7\u03ba\u03b1\u03bd \u03b5\u03b3\u03b3\u03c1\u03b1\u03c6\u03ad\u03c2.",3,"styleClass",4,"ngIf"],["severity","warn","text","\u0394\u03b5\u03bd \u03b2\u03c1\u03ad\u03b8\u03b7\u03ba\u03b1\u03bd \u03b5\u03b3\u03b3\u03c1\u03b1\u03c6\u03ad\u03c2.",3,"styleClass"],["class","debits-info__selected-debits",4,"ngIf"],["class","form mb-1",4,"ngIf"],["responsiveLayout","stack","breakpoint","1070px",3,"value","lazy","lazyLoadOnInit","rowHover","paginator","alwaysShowPaginator","rows","loading","totalRecords","customSort","sortFunction"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","footer"],[1,"debits-info__selected-debits"],[4,"ngTemplateOutlet"],[1,"form","mb-1"],["name","perstType","bindLabel","perigrafi","bindValue","value",1,"ontop-select",3,"appendTo","clearable","items","ngModel","ngModelChange"],[1,"ui-helper-clearfix",2,"text-align","left"],[1,"me-1"],[1,"far","fa-dot-circle","fa-fw","text-success"],[1,"fas","fa-dot-circle","fa-fw","text-warning"],[1,"fixed-width-col-40","text-center"],[3,"binary","ngModel","ngModelChange","onChange"],["class","fixed-width-col-40",4,"ngIf"],[1,"fixed-width-col-40"],[1,"fixed-width-col-120"],[1,"fixed-width-col-170"],["pSortableColumn","hmerominiaLixis",1,"fixed-width-col-100"],["field","hmerominiaLixis"],["pSortableColumn","currentKatharoPoso",1,"fixed-width-col-120"],["field","currentKatharoPoso"],["pSortableColumn","currentProsafksisi",1,"fixed-width-col-120"],["field","currentProsafksisi"],["pSortableColumn","currentSynolo",1,"fixed-width-col-120"],["field","currentSynolo"],[1,"p-column-title"],["class","fixed-width-col-40 text-center",4,"ngIf"],[1,"fixed-width-col-100","text-center"],[1,"fixed-width-col-120","text-end"],["aria-hidden","true",1,"fa-fw",3,"ngClass"],["class","fixed-width-col-470","colspan","5",4,"ngIf"],["class","fixed-width-col-510","colspan","6",4,"ngIf"],["colspan","1",1,"fixed-width-col-100","text-end"],["colspan","5",1,"fixed-width-col-470"],["colspan","6",1,"fixed-width-col-510"],[1,"debits-info","d-flex","flex-wrap","justify-content-around","w-100","align-items-center","mb-1"],[1,"mb-0"],[1,"totalPoso"],["id","sumTotalToBank",1,"totalPoso"],[3,"isPaymentFormValid","ariaDisabled","onlinePaymentSettings","doPaymentSubscription","ismastercardNbgPaymentMethod","govPaymentGatewayApiUrl","buttonText","cancelButtonText","payBtnClick"]],template:function(s,i){1&s&&(e.wR5(0,"eg-loading",0),e.yuY(1,$,1,2,"p-message",1)(2,ie,4,3,"div",2)(3,ne,28,44,"ng-template",null,3,e.gJz)),2&s&&(e.E7m("condition",i.isLoading)("customClass","egr-load-small"),e.yG2(),e.E7m("ngIf",i.bankStatusMessage),e.yG2(),e.E7m("ngIf",i.filteredDebits&&!i.isLoading))},dependencies:[u.QF,u.u_,u.XV,m.sz,m.ue,m.u,m._G,m.SC,a.CG,G.UT,a.uU,g.oJ,k.U3,g.E5,g.q4,Y.yw,D.S,u.cf,u.y,_.sD],encapsulation:2})}}return n})();var v=p(2140),x=p(4940),ae=p(2700),re=p(3800),oe=p(5544);function le(n,l){if(1&n&&e.wR5(0,"p-message",24),2&n){const t=e.GaO();e.E7m("text",t.receiptsMessage)}}function ce(n,l){if(1&n&&e.wR5(0,"p-message",25),2&n){const t=e.GaO();e.E7m("severity",t.bankStatusMessageClass)("text",t.bankStatusMessage)("styleClass","mb-2")}}function pe(n,l){if(1&n&&(e.I0R(0,"div",26)(1,"span",27),e.wR5(2,"i",28),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"span",27),e.wR5(6,"i",29),e.OEk(7),e.wVc(8,"translate"),e.C$Y()()),2&n){const t=e.GaO();e.yG2(3),e.oRS(" ",e.kDX(4,2,t.translation.epayments.waiverOnline),""),e.yG2(4),e.oRS(" ",e.kDX(8,4,t.translation.epayments.waiverOffline),"")}}function de(n,l){if(1&n&&(e.I0R(0,"th",31),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&n){const t=e.GaO(2);e.yG2(),e.cNF(e.kDX(2,1,t.translation.epayments.receipt))}}function he(n,l){if(1&n&&(e.I0R(0,"tr")(1,"th",30),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"th",31),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"th",32),e.OEk(8),e.wVc(9,"translate"),e.wR5(10,"p-sortIcon",33),e.C$Y(),e.I0R(11,"th",31),e.OEk(12),e.wVc(13,"translate"),e.C$Y(),e.I0R(14,"th",34),e.OEk(15),e.wVc(16,"translate"),e.wR5(17,"p-sortIcon",35),e.C$Y(),e.I0R(18,"th",36),e.OEk(19),e.wVc(20,"translate"),e.C$Y(),e.I0R(21,"th",37),e.OEk(22),e.wVc(23,"translate"),e.C$Y(),e.yuY(24,de,3,3,"th",38),e.C$Y()),2&n){const t=e.GaO();e.yG2(2),e.cNF(e.kDX(3,8,t.translation.egwebapps.egrType)),e.yG2(3),e.cNF(e.kDX(6,10,t.translation.epayments.receiptNbr)),e.yG2(3),e.oRS("",e.kDX(9,12,t.translation.epayments.receiptDate)," "),e.yG2(4),e.cNF(e.kDX(13,14,t.translation.epayments.transactionNbr)),e.yG2(3),e.oRS("",e.kDX(16,16,t.translation.epayments.transactionDate)," "),e.yG2(4),e.cNF(e.kDX(20,18,t.translation.egwebapps.description)),e.yG2(3),e.cNF(e.kDX(23,20,t.translation.epayments.poso)),e.yG2(2),e.E7m("ngIf",!(null!=t.paymentsSettings&&t.paymentsSettings.isProviderThirdParty))}}function ue(n,l){if(1&n&&(e.I0R(0,"a",47),e.wR5(1,"i",48),e.C$Y()),2&n){const t=e.GaO(2).$implicit,s=e.GaO();e.u6R("href","",s.financeApiUrl,"/api/PersistedDebits/GetPaymentFile/",t.bankTxnUid,"",e.K6U)}}function me(n,l){if(1&n&&(e.I0R(0,"td",45)(1,"span",40),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.yuY(4,ue,2,2,"a",46),e.C$Y()),2&n){const t=e.GaO().$implicit,s=e.GaO();e.yG2(2),e.cNF(e.kDX(3,2,s.translation.epayments.receipt)),e.yG2(2),e.E7m("ngIf",t.receiptId&&t.bankTxnUid)}}function ge(n,l){if(1&n&&(e.I0R(0,"tr")(1,"td",39)(2,"span",40),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.wR5(5,"i",41),e.C$Y(),e.I0R(6,"td",31)(7,"span",40),e.OEk(8),e.wVc(9,"translate"),e.C$Y(),e.OEk(10),e.C$Y(),e.I0R(11,"td",42)(12,"span",40),e.OEk(13),e.wVc(14,"translate"),e.C$Y(),e.OEk(15),e.wVc(16,"date"),e.C$Y(),e.I0R(17,"td",31)(18,"span",40),e.OEk(19),e.wVc(20,"translate"),e.C$Y(),e.OEk(21),e.C$Y(),e.I0R(22,"td",42)(23,"span",40),e.OEk(24),e.wVc(25,"translate"),e.C$Y(),e.OEk(26),e.wVc(27,"date"),e.C$Y(),e.I0R(28,"td",36)(29,"span",40),e.OEk(30),e.wVc(31,"translate"),e.C$Y(),e.OEk(32),e.C$Y(),e.I0R(33,"td",43)(34,"span",40),e.OEk(35),e.wVc(36,"translate"),e.C$Y(),e.OEk(37),e.wVc(38,"currency"),e.C$Y(),e.yuY(39,me,5,4,"td",44),e.C$Y()),2&n){const t=l.$implicit,s=e.GaO();e.yG2(3),e.cNF(e.kDX(4,17,s.translation.egwebapps.egrType)),e.yG2(2),e.m8U(t.icon),e.yG2(3),e.cNF(e.kDX(9,19,s.translation.epayments.receiptNbr)),e.yG2(2),e.oRS(" ",t.receiptIncrNr," "),e.yG2(3),e.cNF(e.kDX(14,21,s.translation.epayments.receiptDate)),e.yG2(2),e.oRS(" ",e.g7$(16,23,t.receiptDateCreated,"dd/LL/yyyy")," "),e.yG2(4),e.cNF(e.kDX(20,26,s.translation.epayments.transactionNbr)),e.yG2(2),e.oRS(" ",t.bankTxnPaymentRef," "),e.yG2(3),e.cNF(e.kDX(25,28,s.translation.epayments.transactionDate)),e.yG2(2),e.oRS(" ",e.g7$(27,30,t.bankTxnDateCreated,"dd/LL/yyyy")," "),e.yG2(4),e.cNF(e.kDX(31,33,s.translation.egwebapps.description)),e.yG2(2),e.oRS(" ",t.description," "),e.yG2(3),e.cNF(e.kDX(36,35,s.translation.epayments.poso)),e.yG2(2),e.oRS(" ",e.wB1(38,37,t.paymentTotal,"\u20ac","symbol","1.2")," "),e.yG2(2),e.E7m("ngIf",!(null!=s.paymentsSettings&&s.paymentsSettings.isProviderThirdParty))}}function fe(n,l){if(1&n&&(e.I0R(0,"tr")(1,"td"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&n){const t=e.GaO();e.yG2(),e.e48("colspan",null!=t.paymentsSettings&&t.paymentsSettings.isProviderThirdParty?7:8),e.yG2(),e.oRS(" ",e.kDX(3,2,t.translation.egwebapps.egrNoResultsFound)," ")}}function ye(n,l){if(1&n&&(e.I0R(0,"tr")(1,"td",49)(2,"strong"),e.OEk(3),e.C$Y()(),e.I0R(4,"td",50)(5,"strong"),e.OEk(6),e.wVc(7,"translate"),e.wVc(8,"currency"),e.C$Y()()()),2&n){const t=e.GaO();e.yG2(3),e.oRS("\u03a0\u03bb\u03ae\u03b8\u03bf\u03c2: ",null==t.orderedReceiptsFiltered?null:t.orderedReceiptsFiltered.length,""),e.yG2(),e.E7m("ngClass",null!=t.paymentsSettings&&t.paymentsSettings.isProviderThirdParty?"fixed-width-col-120":"fixed-width-col-220"),e.e48("colspan",null!=t.paymentsSettings&&t.paymentsSettings.isProviderThirdParty?1:2),e.yG2(2),e.CAO("",e.kDX(7,5,t.translation.egwebapps.egrTotalCost),": ",e.wB1(8,7,t.totalPoso,"EUR","symbol","1.2-2"),"")}}const A=()=>({width:"100%"});let P=(()=>{class n{constructor(t,s,i,r,o,c,d){this.oidcSecuritySrv=t,this.epaymentsSrv=s,this.egPaymentSrv=i,this.appCacheSv=r,this.toasterSrv=o,this.cdr=c,this.route=d,this.onDestroy=new y.E,this.totalPoso=0,this.bankStatusMessageClass=void 0,this.oikonomikiBankMessagesEn=S.o9,this.receiptType=0,this.isLoading=!0,this.receiptNbrFilter=null,this.hmerominiaApodiksisRange=null,this.hmerominiaSinallagisRange=null,this.today=new Date,this.yearRange=(0,a.sj)(50,50),this.tropoiPliromis=[]}ngOnInit(){this.setFiltersFromQueryParams(),typeof AppConfOptions<"u"&&AppConfOptions&&(AppConfOptions.finance_api?this.financeApiUrl=(0,a.sF)(AppConfOptions.finance_api):AppConfOptions.epayments_api&&(this.financeApiUrl=(0,a.sF)(AppConfOptions.epayments_api)),this.banksApiUrl=(0,a.w1)(AppConfOptions.gov_payment_gateway_api)?this.financeApiUrl:(0,a.sF)(AppConfOptions.gov_payment_gateway_api)),this.appCacheSv.translation$.pipe((0,h.a)(this.onDestroy)).subscribe(t=>{t&&(this.translation=t),(0,a.Er)(this.cdr)}),this.appCacheSv.selectedLang$.pipe((0,h.a)(this.onDestroy)).subscribe(t=>{t&&(this.tropoiPliromis="en"===(this.selectedLang=t,t)?[{value:0,perigrafi:"All"},{value:1,perigrafi:"Organization's Fund Office"},{value:2,perigrafi:"E-Services"}]:[{value:0,perigrafi:"\u038c\u03bb\u03bf\u03b9"},{value:1,perigrafi:"\u03a4\u03b1\u03bc\u03b5\u03af\u03bf \u0394\u03ae\u03bc\u03bf\u03c5"},{value:2,perigrafi:"Online"}])}),this.isLoading=!0,this.egPaymentSrv.getPaymentSetting(`${this.banksApiUrl}`).subscribe(t=>{t&&(this.paymentsSettings=t)}),this.oidcSecuritySrv.getUserData().pipe((0,h.a)(this.onDestroy)).subscribe(t=>{t&&(this.user=t,this.user.email=(0,a.w1)(this.user.email)?this.user.email:this.user.email.trim(),this.user.username=(0,a.w1)(this.user.username)?this.user.username:this.user.username.trim(),this.user.tin=(0,a.w1)(this.user.tin)?this.user.tin:this.user.tin.trim(),this.user.family_name=(0,a.w1)(this.user.family_name)?this.user.family_name:this.user.family_name.trim(),this.user.given_name=(0,a.w1)(this.user.given_name)?this.user.given_name:this.user.given_name.trim(),this.user.fathers_name=(0,a.w1)(this.user.fathers_name)?this.user.fathers_name:this.user.fathers_name.trim(),this.user.mothers_name=(0,a.w1)(this.user.mothers_name)?this.user.mothers_name:this.user.mothers_name.trim(),this.user.name=(0,a.w1)(this.user.name)?this.user.name:this.user.name.trim(),this.user.address_city=(0,a.w1)(this.user.address_city)?this.user.address_city:this.user.address_city.trim(),this.user.address_country_code=(0,a.w1)(this.user.address_country_code)?this.user.address_country_code:this.user.address_country_code.trim(),this.user.address_country_num=(0,a.w1)(this.user.address_country_num)?this.user.address_country_num:this.user.address_country_num.trim(),this.user.address_zip=(0,a.w1)(this.user.address_zip)?this.user.address_zip:this.user.address_zip.trim(),this.user.address=(0,a.w1)(this.user.address)?this.user.address:this.user.address.trim(),this.user.adt=(0,a.w1)(this.user.adt)?this.user.adt:this.user.adt.trim(),this.user.phone_number=(0,a.w1)(this.user.phone_number)?this.user.phone_number:this.user.phone_number.trim())}),this.egPaymentSrv.getBankMessages(this.banksApiUrl).pipe((0,C.G)(t=>t?(this.oikonomikiBankMessages=t,this.route.queryParams.pipe((0,h.a)(this.onDestroy))):(0,ae.of)(!1))).subscribe(t=>{if(t){if(t.messagecode||t.paymentStatus){let i=t.messagecode?t.messagecode:t.paymentStatus;this.bankStatusMessage="el"==this.selectedLang?this.oikonomikiBankMessages[i]:this.oikonomikiBankMessagesEn[i],"TRANSACTION_COMPLETED"==i||"APPROVED"==i?(this.toasterSrv.showSuccess("",this.bankStatusMessage),this.bankStatusMessageClass="success"):(this.bankStatusMessageClass="error",this.toasterSrv.showError("",this.bankStatusMessage))}(0,a.Er)(this.cdr),this._initReceiptsByTin()}else this.toasterSrv.showError("",this.translation.egwebapps.egrProblemFound),this.isLoading=!1,(0,a.Er)(this.cdr)})}ngOnChanges(t){t&&t.tabChanged&&(this.bankStatusMessage=void 0),(0,a.Er)(this.cdr)}ngOnDestroy(){this.onDestroy.next(null)}onReceiptTypeChanged(t){this.receiptType=t,(0,a.Er)(this.cdr)}onSearch(){this.isLoading=!0,this.orderedReceiptsFiltered=(0,a.O0)(this.orderedReceipts);let t=[];if(this.hmerominiaApodiksisRange){let s=this.orderedReceiptsFiltered.filter(i=>(0,v.c)(new Date(i.receiptDateCreated),{start:new Date(this.hmerominiaApodiksisRange[0]),end:new Date(this.hmerominiaApodiksisRange[1])}));s&&s.length&&s.forEach(i=>{t.push(i)})}if(this.hmerominiaSinallagisRange){let s=this.orderedReceiptsFiltered.filter(i=>(0,v.c)(new Date(i.bankTxnDateCreated),{start:new Date(this.hmerominiaSinallagisRange[0]),end:new Date(this.hmerominiaSinallagisRange[1])}));s&&s.length&&s.forEach(i=>{t.push(i)})}!this.hmerominiaApodiksisRange&&!this.hmerominiaSinallagisRange&&(t=(0,a.O0)(this.orderedReceipts)),this.orderedReceiptsFiltered=x.intersection(t),(0,a.Er)(this.cdr),this._filterByType(this.orderedReceiptsFiltered),this._filterByReceiptIncrNr(this.orderedReceiptsFiltered)}onClear(){this.orderedReceiptsFiltered=(0,a.O0)(this.orderedReceipts),this.hmerominiaApodiksisRange=null,this.hmerominiaSinallagisRange=null,this.receiptType=0,(0,a.Er)(this.cdr)}setFiltersFromQueryParams(){this.receiptNbrFilter=this.route.snapshot.queryParamMap.get("receiptNbr");let t=this.route.snapshot.queryParamMap.get("receiptDate"),s=Date.parse(t);if(!isNaN(s)){let i=new Date(s);i.setHours(0,0,0,0),this.hmerominiaApodiksisRange=[new Date(i),new Date(i)]}}_initReceiptsByTin(){this.isLoading=!0;let s={tin:this.user.tin,year:(new Date).getFullYear()};this.epaymentsSrv.getPaymentsByTin(s).subscribe(i=>{i&&(this.receipts=i,this.totalPoso=0,this.receipts.entries&&this.receipts.entries.length>0&&this.receipts.entries.forEach(r=>{this.totalPoso+=r.receiptAmount}),!this.receipts.statusCode||2!=this.receipts.statusCode&&3!=this.receipts.statusCode?1==this.receipts.statusCode&&0==this.receipts.entries.length?this.receiptsMessage=this.translation.epayments.revDebtorNotFound:this._fillOrderedReceipts():this.receipts.responseMetadata.metadata.hasOwnProperty("REV_DEPTOR_NOT_FOUND")?(this.toasterSrv.showWarning("",this.translation.epayments.revDebtorNotFound),this.receiptsMessage=this.translation.epayments.revDebtorNotFound):this.receipts.responseMetadata.metadata.hasOwnProperty("REV_MULTIPLE_DEPTORS_FOUND")&&(this.toasterSrv.showError("error",this.translation.epayments.duplicateTin),this.receiptsMessage=this.translation.epayments.duplicateTin)),this.isLoading=!1,(0,a.Er)(this.cdr)})}_filterByType(t){t&&(2===this.receiptType?this.orderedReceiptsFiltered=t.filter(s=>!0===s.isOnline):1===this.receiptType&&(this.orderedReceiptsFiltered=t.filter(s=>!1===s.isOnline||!s.isOnline))),this.isLoading=!1,(0,a.Er)(this.cdr)}_filterByReceiptIncrNr(t){t&&this.receiptNbrFilter&&(this.orderedReceiptsFiltered=t.filter(s=>s.receiptIncrNr&&s.receiptIncrNr.toString().toLowerCase()==this.receiptNbrFilter.toString().toLowerCase())),this.isLoading=!1,(0,a.Er)(this.cdr)}_fillOrderedReceipts(){this.orderedReceipts=x.orderBy(this.receipts.entries,["receiptDateCreated","bankTxnDateCreated","id"],["desc","desc","desc"]),this.orderedReceipts.forEach(t=>{!t.receiptDateCreated&&!t.bankTxnDateCreated&&this.orderedReceipts.unshift(t)}),this.orderedReceipts.forEach(t=>{t.icon=0==t.isOnline?"far fa-building":"fas fa-desktop",t.description=null==t.bankTxnDescr?t.receiptDescr:t.bankTxnDescr,t.paymentTotal=null==t.bankTxnPaymentTotal?t.receiptAmount:t.bankTxnPaymentTotal,t.link=null!=t.receiptId&&null!=t.bankTxnUid?`<a href="${this.financeApiUrl}/api/PersistedDebits/GetPaymentFile/${t.bankTxnUid}" target="_blank"><i class="far fa-file-pdf"></i></a>`:""}),this.orderedReceiptsFiltered=(0,a.O0)(this.orderedReceipts),(0,a.Er)(this.cdr),this.onSearch()}handleError(t){return(0,re.c)(t.message)}_customSort(t){if(t.hasOwnProperty("field"))switch(t.field){case"receiptDateCreated":this.orderedReceiptsFiltered=t.hasOwnProperty("order")&&1==t.order?this.orderedReceiptsFiltered.sort(function(s,i){return+new Date(i.receiptDateCreated)-+new Date(s.receiptDateCreated)>0?1:-1}):this.orderedReceiptsFiltered.sort(function(s,i){return+new Date(i.receiptDateCreated)-+new Date(s.receiptDateCreated)<0?1:-1});break;case"bankTxnDateCreated":this.orderedReceiptsFiltered=t.hasOwnProperty("order")&&1==t.order?this.orderedReceiptsFiltered.sort(function(s,i){return+new Date(i.bankTxnDateCreated)-+new Date(s.bankTxnDateCreated)>0?1:-1}):this.orderedReceiptsFiltered.sort(function(s,i){return+new Date(i.bankTxnDateCreated)-+new Date(s.bankTxnDateCreated)<0?1:-1});break;default:this.orderedReceiptsFiltered=t.hasOwnProperty("order")&&1==t.order?this.receipts.entries.sort(function(s,i){return i.receiptIncrNr&&s.receiptIncrNr&&parseInt(i.receiptIncrNr.split("/").pop())-parseInt(s.receiptIncrNr.split("/").pop())<0?1:-1}):this.receipts.entries.sort(function(s,i){return i.receiptIncrNr&&s.receiptIncrNr&&parseInt(i.receiptIncrNr.split("/").pop())-parseInt(s.receiptIncrNr.split("/").pop())>0?1:-1})}}static{this.\u0275fac=function(s){return new(s||n)(e.GI1(b.Bf),e.GI1(R.A),e.GI1(a.U5),e.GI1(w.i),e.GI1(a.y6),e.GI1(e.kD9),e.GI1(f.gV))}}static{this.\u0275cmp=e.In1({type:n,selectors:[["app-receipts"]],inputs:{tabChanged:"tabChanged"},features:[e.SYr],decls:40,vars:66,consts:[["severity","warn",3,"text",4,"ngIf"],[3,"severity","text","styleClass",4,"ngIf"],[3,"header","styleClass"],[1,"form"],[1,"row"],[1,"form-group","col-12","col-sm-6","col-md-4"],["for","recType"],["name","receiptNbr","type","text",1,"form-control",3,"placeholder","ngModel","ngModelChange"],["for","hmerominiaApodiksisRange"],["name","hmerominiaApodiksisRange","dateFormat","dd/mm/yy","placeholder","\u03b7\u03b7/\u03bc\u03bc/\u03c7\u03c7\u03c7\u03c7","selectionMode","range","appendTo","body",3,"baseZIndex","firstDayOfWeek","selectOtherMonths","monthNavigator","yearNavigator","yearRange","showIcon","showButtonBar","readonlyInput","touchUI","ngModel","ngModelChange"],["for","exchangeDatepicker"],["name","hmerominiaSinallagisRange","dateFormat","dd/mm/yy","placeholder","\u03b7\u03b7/\u03bc\u03bc/\u03c7\u03c7\u03c7\u03c7","selectionMode","range","appendTo","body",3,"baseZIndex","firstDayOfWeek","selectOtherMonths","monthNavigator","yearNavigator","yearRange","showIcon","showButtonBar","readonlyInput","touchUI","ngModel","ngModelChange"],["name","recType","bindLabel","perigrafi","bindValue","value",3,"searchable","clearable","items","ngModel","ngModelChange"],[1,"form-buttons","d-flex","flex-wrap"],["type","button",1,"btn","btn-primary","btn-sm","me-1",3,"click"],["aria-hidden","true",1,"fas","fa-search","fa-fw"],["type","button",1,"btn","btn-warning","btn-sm","text-white",3,"click"],["aria-hidden","true",1,"fas","fa-times","fa-fw"],["responsiveLayout","stack","breakpoint","1070px",3,"value","lazy","lazyLoadOnInit","rowHover","paginator","alwaysShowPaginator","rows","loading","totalRecords","customSort","sortFunction"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","footer"],["severity","warn",3,"text"],[3,"severity","text","styleClass"],[1,"ui-helper-clearfix",2,"text-align","left"],[1,"me-1"],[1,"fas","fa-desktop","fa-fw"],[1,"far","fa-building","fa-fw"],[1,"fixed-width-col-40"],[1,"fixed-width-col-100"],["pSortableColumn","receiptDateCreated",1,"fixed-width-col-170"],["field","receiptDateCreated"],["pSortableColumn","bankTxnDateCreated",1,"fixed-width-col-170"],["field","bankTxnDateCreated"],[1,"fixed-width-col-210"],[1,"fixed-width-col-120"],["class","fixed-width-col-100",4,"ngIf"],[1,"fixed-width-col-40","text-center"],[1,"p-column-title"],["aria-hidden","true"],[1,"fixed-width-col-170","text-center"],[1,"fixed-width-col-120","text-end"],["class","fixed-width-col-100 text-center",4,"ngIf"],[1,"fixed-width-col-100","text-center"],["target","_blank","aria-label","\u03a3\u03cd\u03bd\u03b4\u03b5\u03c3\u03bc\u03bf\u03c2 \u03b3\u03b9\u03b1 \u0391\u03c1\u03c7\u03b5\u03af\u03bf \u0395\u03ba\u03c4\u03cd\u03c0\u03c9\u03c3\u03b7\u03c2","rel","noopener",3,"href",4,"ngIf"],["target","_blank","aria-label","\u03a3\u03cd\u03bd\u03b4\u03b5\u03c3\u03bc\u03bf\u03c2 \u03b3\u03b9\u03b1 \u0391\u03c1\u03c7\u03b5\u03af\u03bf \u0395\u03ba\u03c4\u03cd\u03c0\u03c9\u03c3\u03b7\u03c2","rel","noopener",3,"href"],["aria-hidden","true",1,"far","fa-file-pdf"],["colspan","6",1,"fixed-width-col-790"],[1,"text-end",3,"ngClass"]],template:function(s,i){1&s&&(e.yuY(0,le,1,1,"p-message",0)(1,ce,1,3,"p-message",1),e.I0R(2,"p-panel",2)(3,"form",3)(4,"div",4)(5,"div",5)(6,"label",6),e.OEk(7),e.wVc(8,"translate"),e.C$Y(),e.I0R(9,"input",7),e.iHE("ngModelChange",function(o){return e.kNx(i.receiptNbrFilter,o)||(i.receiptNbrFilter=o),o}),e.C$Y()(),e.I0R(10,"div",5)(11,"label",8),e.OEk(12),e.wVc(13,"translate"),e.C$Y(),e.I0R(14,"p-calendar",9),e.iHE("ngModelChange",function(o){return e.kNx(i.hmerominiaApodiksisRange,o)||(i.hmerominiaApodiksisRange=o),o}),e.C$Y()(),e.I0R(15,"div",5)(16,"label",10),e.OEk(17),e.wVc(18,"translate"),e.C$Y(),e.I0R(19,"p-calendar",11),e.iHE("ngModelChange",function(o){return e.kNx(i.hmerominiaSinallagisRange,o)||(i.hmerominiaSinallagisRange=o),o}),e.C$Y()(),e.I0R(20,"div",5)(21,"label",6),e.OEk(22),e.wVc(23,"translate"),e.C$Y(),e.I0R(24,"ng-select",12),e.iHE("ngModelChange",function(o){return e.kNx(i.receiptType,o)||(i.receiptType=o),o}),e.qCj("ngModelChange",function(o){return i.onReceiptTypeChanged(o)}),e.C$Y()()(),e.I0R(25,"div",13)(26,"button",14),e.qCj("click",function(){return i.onSearch()}),e.wR5(27,"i",15),e.OEk(28),e.wVc(29,"translate"),e.C$Y(),e.I0R(30,"button",16),e.qCj("click",function(){return i.onClear()}),e.wR5(31,"i",17),e.OEk(32),e.wVc(33,"translate"),e.C$Y()()()(),e.I0R(34,"p-table",18),e.qCj("sortFunction",function(o){return i._customSort(o)}),e.yuY(35,pe,9,6,"ng-template",19)(36,he,25,22,"ng-template",20)(37,ge,40,42,"ng-template",21)(38,fe,4,4,"ng-template",22)(39,ye,9,12,"ng-template",23),e.C$Y()),2&s&&(e.E7m("ngIf",i.receiptsMessage&&""!==i.receiptsMessage),e.yG2(),e.E7m("ngIf",!i.isLoading&&i.bankStatusMessage&&""!==i.bankStatusMessage),e.yG2(),e.E7m("header",i.translation.egwebapps.egrSearchFilters)("styleClass","mb-3"),e.yG2(5),e.cNF(e.kDX(8,52,i.translation.epayments.receiptNbr)),e.yG2(2),e.E7m("placeholder",i.translation.epayments.receiptNbr),e.OKB("ngModel",i.receiptNbrFilter),e.yG2(3),e.cNF(e.kDX(13,54,i.translation.epayments.receiptDateRange)),e.yG2(2),e.m_g(e.q4q(64,A)),e.E7m("baseZIndex",9999)("firstDayOfWeek",1)("selectOtherMonths",!0)("monthNavigator",!0)("yearNavigator",!0)("yearRange",i.yearRange)("showIcon",!0)("showButtonBar",!0)("readonlyInput",!0)("touchUI",!0),e.OKB("ngModel",i.hmerominiaApodiksisRange),e.yG2(3),e.cNF(e.kDX(18,56,i.translation.epayments.transactionDateRange)),e.yG2(2),e.m_g(e.q4q(65,A)),e.E7m("baseZIndex",9999)("firstDayOfWeek",1)("selectOtherMonths",!0)("monthNavigator",!0)("yearNavigator",!0)("yearRange",i.yearRange)("showIcon",!0)("showButtonBar",!0)("readonlyInput",!0)("touchUI",!0),e.OKB("ngModel",i.hmerominiaSinallagisRange),e.yG2(3),e.cNF(e.kDX(23,58,i.translation.egwebapps.egrPaymentMethod)),e.yG2(2),e.E7m("searchable",!1)("clearable",!1)("items",i.tropoiPliromis),e.OKB("ngModel",i.receiptType),e.yG2(4),e.oRS(" ",e.kDX(29,60,i.translation.egwebapps.egrSearchBtn)," "),e.yG2(4),e.oRS(" ",e.kDX(33,62,i.translation.egwebapps.egrClearBtn)," "),e.yG2(2),e.E7m("value",i.orderedReceiptsFiltered)("lazy",!1)("lazyLoadOnInit",!1)("rowHover",!0)("paginator",!0)("alwaysShowPaginator",!1)("rows",10)("loading",i.isLoading)("totalRecords",null==i.orderedReceiptsFiltered?null:i.orderedReceiptsFiltered.length)("customSort",!0))},dependencies:[u.QF,u.u_,m.sz,m.ot,m.ue,m.u,m._G,m.SC,G.UT,g.oJ,k.U3,g.E5,g.q4,oe.Yf,D.S,O.s,u.cf,u.y,_.sD],encapsulation:2,changeDetection:0})}}return n})();var _e=p(2656);function Ce(n,l){if(1&n&&e.wR5(0,"p-message",3),2&n){const t=e.GaO();e.E7m("text",null==t.translation?null:t.translation.egwebapps.egwebappsLoginMesg)}}function be(n,l){if(1&n&&(e.I0R(0,"p-panel",6),e.wR5(1,"div",7),e.wVc(2,"decodeHtmlString"),e.C$Y()),2&n){const t=e.GaO(2);e.E7m("header",null==t.translation?null:t.translation.egwebapps.information)("styleClass","tab-msg mb-3")("toggleable",!0),e.yG2(),e.E7m("innerHTML",e.kDX(2,4,t.tabMsg),e.E3n)}}function we(n,l){if(1&n&&e.wR5(0,"app-receipts",11),2&n){const t=e.GaO(3);e.E7m("tabChanged",t.onTbChanged)}}function ke(n,l){if(1&n){const t=e.KQA();e.I0R(0,"p-tabView",8),e.qCj("onChange",function(i){e.usT(t);const r=e.GaO(2);return e.CGJ(r.onTabChanged(i))}),e.I0R(1,"p-tabPanel",9),e.wR5(2,"app-debits"),e.C$Y(),e.I0R(3,"p-tabPanel",9),e.yuY(4,we,1,1,"ng-template",10),e.C$Y()()}if(2&n){const t=e.GaO(2);e.E7m("activeIndex",t.index),e.yG2(),e.E7m("header",null==t.translation?null:t.translation.epayments.debitsTab),e.yG2(2),e.E7m("header",null==t.translation?null:t.translation.epayments.paymentsTab)}}function De(n,l){if(1&n&&(e.SAx(0),e.yuY(1,be,3,6,"p-panel",4)(2,ke,5,3,"p-tabView",5),e.k70()),2&n){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.tabMsg),e.yG2(),e.E7m("ngIf",t.isAuthorized)}}const Re=[{path:"",component:(()=>{class n{constructor(t,s,i,r,o,c){this.oidcSecuritySrv=t,this.appCacheSrv=s,this.location=i,this.router=r,this.route=o,this.cdr=c,this.onDestroy=new y.E,this.afmNotFound=!1,this.index=0,this.onTbChanged=!1,this.selectedLang="el"}ngOnInit(){this.appCacheSrv.translation$.pipe((0,h.a)(this.onDestroy)).subscribe(t=>{t&&(this.translation=t),(0,a.Er)(this.cdr)}),this.appCacheSrv.selectedLang$.pipe((0,h.a)(this.onDestroy)).subscribe(t=>{t&&(this.selectedLang=t),AppConfOptions&&1==AppConfOptions.multilingual&&"el"!=this.selectedLang&&AppConfOptions.epayments_debits_tab_info_en&&""!=AppConfOptions.epayments_debits_tab_info_en&&this.router.url.includes("debits")?this.tabMsg=AppConfOptions.epayments_debits_tab_info_en:AppConfOptions.epayments_debits_tab_info&&""!=AppConfOptions.epayments_debits_tab_info&&"el"==this.selectedLang&&this.router.url.includes("debits")&&(this.tabMsg=AppConfOptions.epayments_debits_tab_info),AppConfOptions&&1==AppConfOptions.multilingual&&"el"!=this.selectedLang&&AppConfOptions.epayments_receipts_tab_info_en&&""!=AppConfOptions.epayments_receipts_tab_info_en&&this.router.url.includes("receipts")?this.tabMsg=AppConfOptions.epayments_receipts_tab_info_en:AppConfOptions.epayments_receipts_tab_info&&""!=AppConfOptions.epayments_receipts_tab_info&&"el"==this.selectedLang&&this.router.url.includes("receipts")&&(this.tabMsg=AppConfOptions.epayments_receipts_tab_info),(0,a.Er)(this.cdr)}),this.oidcSecuritySrv.isAuthenticated$.pipe((0,C.G)(t=>(this.isAuthorized=null!=t&&t.isAuthenticated,this.appCacheSrv.user$)),(0,h.a)(this.onDestroy)).subscribe(t=>{this.afmNotFound=!1,(0,a.Er)(this.cdr),t&&(0,a.w1)(t.tin)&&AppConfOptions.epayments_afm_required&&(this.afmNotFound=!0),(0,a.Er)(this.cdr)}),this.index="receipts"===this.route.children[0].snapshot.url[0].path?1:0,(0,a.Er)(this.cdr)}ngOnDestroy(){this.onDestroy.next(null)}onTabChanged(t){0==t.index?(this.router.navigate(["./debits"],{relativeTo:this.route}),AppConfOptions&&AppConfOptions.epayments_debits_tab_info&&""!=AppConfOptions.epayments_debits_tab_info&&(this.tabMsg=AppConfOptions.epayments_debits_tab_info)):(this.router.navigate(["./receipts"],{relativeTo:this.route}),this.onTbChanged=!0,AppConfOptions&&AppConfOptions.epayments_receipts_tab_info&&""!=AppConfOptions.epayments_receipts_tab_info&&(this.tabMsg=AppConfOptions.epayments_receipts_tab_info)),(0,a.Er)(this.cdr)}static{this.\u0275fac=function(s){return new(s||n)(e.GI1(b.Bf),e.GI1(w.i),e.GI1(u.oB),e.GI1(f.E5),e.GI1(f.gV),e.GI1(e.kD9))}}static{this.\u0275cmp=e.In1({type:n,selectors:[["app-epayments-layout"]],inputs:{isAuthorized:"isAuthorized"},decls:4,vars:3,consts:[[1,"module-title"],["severity","warn",3,"text",4,"ngIf"],[4,"ngIf"],["severity","warn",3,"text"],[3,"header","styleClass","toggleable",4,"ngIf"],[3,"activeIndex","onChange",4,"ngIf"],[3,"header","styleClass","toggleable"],[3,"innerHTML"],[3,"activeIndex","onChange"],[3,"header"],["pTemplate","content"],[3,"tabChanged"]],template:function(s,i){1&s&&(e.I0R(0,"h3",0),e.OEk(1),e.C$Y(),e.yuY(2,Ce,1,1,"p-message",1)(3,De,3,2,"ng-container",2)),2&s&&(e.yG2(),e.cNF(null==i.translation?null:i.translation.menu.epaymentsMenuItem),e.yG2(),e.E7m("ngIf",!i.isAuthorized),e.yG2(),e.E7m("ngIf",!i.afmNotFound))},dependencies:[u.u_,k.U3,I.DX,I.Gk,D.S,O.s,T,P,_e.m],encapsulation:2})}}return n})(),children:[{path:"",pathMatch:"full",redirectTo:"debits"},{path:"debits",component:T},{path:"receipts",component:P}]}];let Ee=(()=>{class n{static{this.\u0275fac=function(s){return new(s||n)}}static{this.\u0275mod=e.a4G({type:n})}static{this.\u0275inj=e.s3X({imports:[f.qQ.forChild(Re),f.qQ]})}}return n})(),Ie=(()=>{class n{static{this.\u0275fac=function(s){return new(s||n)}}static{this.\u0275mod=e.a4G({type:n})}static{this.\u0275inj=e.s3X({providers:[R.A],imports:[Ee,M.k,B.IB,_.O0.forChild()]})}}return n})()}}]);